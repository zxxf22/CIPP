{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"What is this? \u00b6 The CyberDrain Improved Partner Portal is a portal to help manage administration for Microsoft Partners. The current Microsoft partner landscape makes it fairly hard to manage multi tenant situations, with loads of manual work. Microsoft Lighthouse might resolve this in the future but development of this is lagging far behind development of the current market for Microsoft Partners. This project is a way to help you with administration, with user management, and deploying your own preferred standards. It's not a replacement for security tools, or a way to cut costs on specific subscriptions. The tool should assist you in removing the gripes with standard partner management and save you several hours per engineer per month. Deployment and Getting Started \u00b6 If you want to self-host, check out the installation manual . You will need some knowledge of Static Web Apps, Azure Functions, and Azure KeyVault Why are you making this? \u00b6 I'm kind of done waiting for vendors to catch up to what we actually need. All RMM vendors are dramaticaly slow adopting cloud management. Microsoft themselves don't understand the Managed services markets, there are vendors that have tried jumping into the gap but either have unreasonable fees, weird constructions, require Global Admins without MFA, or just don't innovate at a pace that is required of cloud services right now. I'm also annoyed the untransparant behaviour that many companies in our market are showing. Most are claiming that working with the Microsoft Partner APIs is difficult, and requires a very heavy development team. I'm a guy that had no webdesign knowledge before this and created the first release of this app in 3 weekends. Vendors that claim high difficulty or issues with integration are simply not giving this any priority. This is also why the changelog contains how many hours I've spend to built each release. These hours are directly taken from my VSCode Extensions. I was recently on a call with one of my friends and he said he was changing the world. That insipred me to change the world just a little bit too. :) I'm hoping that this is one of the tools that make you smile. What's the pricing? \u00b6 This project is FREE but we do have a Sponsorware component. The sponsorware structure for this project is pretty simple; the code is available to everyone and free to use. You will need some technical know-how to put it all together. Sponsors receive the following benefits For users of the project that sponsor: \u00b6 The project will be hosted for you. The hosted version will always be the latest release and automatically updated. You'll also receive a staging environment with the latest (nightly/beta) build, to see new features before anyone else. You will receive priority on support issues reported on Github. You will be able to make 1 priortized feature request per month. Sponsorship allows me to sink some more time into this project and keep it free, so please consider it. :) For company sponsors, depending on sponsor level you can get the following benefits; \u00b6 Your company logo will be featured on this readme page at the top. Your company logo will be featured on https://cyberdrain.com A small version of your company logo with a link to your homepage will be on the footer, each user will see this on each page. What is the functionality? \u00b6 The current build functionality is described below, also check out our Changelog in the documentation folder. Any unmarked items are in development. General \u00b6 Allow adding/removing tenants to skip Create two user levels for access to settings: User and Admin, Admin can add exclusions/remove exclusions/access complete logs. Allow export of logs to SIEM/External SOC Applications \u00b6 List all applications in tenants List installation status of a specific application per device Add/Remove custom applications via win32(intunewin) to multiple tenants Add Office Apps to multiple tenants Add/Remove Chocolatey Apps to multiple tenants Add/Remove Ninite Pro Apps to multiple tenants Assign Apps to All Devices or All Users Report on installation status Assign apps to specific groups Devices \u00b6 Add autopilot configuration Add Enrollment Status Pages Add Autopilot Devices Add Administrative templates / Policies Users \u00b6 List all administered users with tenant filtering options Convert user to shared mailbox View/edit licenses List users Add/Remove users to groups User alerting Tenant Administration \u00b6 Deploy any custom graph command Set selected defaults across selected tenants Monitor defaults across tenants. Tenant Alerting Security \u00b6 Authentication is handled by Azure AD using static web apps security. This means the API is only reachable for authenticated users you've invited. For most of the security info related to that check out our staticwebapp.config.json and/or the doc pages on static web apps. Do you see something that might be a security risk, even the smallest? report it and we will handle it asap. Check out our security reporting options Contributions \u00b6 Feel free to send pull requests or fill out issues when you encounter them, sponsors get a priority on issues and bugs. I'm also completely open to adding direct maintainers/contributors and working together. If you decide to contribute; remember that keeping the portal fast is a key component. CIPP is supposed to go brrrrr, any improvements that help with speed are welcomed. Welcomed changes/contributions in no particular order \u00b6 the code quality and repetive code on the functions can use some work HTML and JQuery definitely needs consolidation and improvement, as I am not a web developer I did what I could... :) Spelling and grammar check, both of APIs and the actual text. Special thanks \u00b6 I'd like to give special thanks to the people that made this project possible; Kyle Hansloven Ray Orsini The Team at MSP.zone/MSP'R'Us Gavin Stone at MSPGeek MSP2.0 for helping with some visual input. Scott, Chris, Jon, and others that helped me with some of the internals of the app.","title":"Home"},{"location":"#what-is-this","text":"The CyberDrain Improved Partner Portal is a portal to help manage administration for Microsoft Partners. The current Microsoft partner landscape makes it fairly hard to manage multi tenant situations, with loads of manual work. Microsoft Lighthouse might resolve this in the future but development of this is lagging far behind development of the current market for Microsoft Partners. This project is a way to help you with administration, with user management, and deploying your own preferred standards. It's not a replacement for security tools, or a way to cut costs on specific subscriptions. The tool should assist you in removing the gripes with standard partner management and save you several hours per engineer per month.","title":"What is this?"},{"location":"#deployment-and-getting-started","text":"If you want to self-host, check out the installation manual . You will need some knowledge of Static Web Apps, Azure Functions, and Azure KeyVault","title":"Deployment and Getting Started"},{"location":"#why-are-you-making-this","text":"I'm kind of done waiting for vendors to catch up to what we actually need. All RMM vendors are dramaticaly slow adopting cloud management. Microsoft themselves don't understand the Managed services markets, there are vendors that have tried jumping into the gap but either have unreasonable fees, weird constructions, require Global Admins without MFA, or just don't innovate at a pace that is required of cloud services right now. I'm also annoyed the untransparant behaviour that many companies in our market are showing. Most are claiming that working with the Microsoft Partner APIs is difficult, and requires a very heavy development team. I'm a guy that had no webdesign knowledge before this and created the first release of this app in 3 weekends. Vendors that claim high difficulty or issues with integration are simply not giving this any priority. This is also why the changelog contains how many hours I've spend to built each release. These hours are directly taken from my VSCode Extensions. I was recently on a call with one of my friends and he said he was changing the world. That insipred me to change the world just a little bit too. :) I'm hoping that this is one of the tools that make you smile.","title":"Why are you making this?"},{"location":"#whats-the-pricing","text":"This project is FREE but we do have a Sponsorware component. The sponsorware structure for this project is pretty simple; the code is available to everyone and free to use. You will need some technical know-how to put it all together. Sponsors receive the following benefits","title":"What's the pricing?"},{"location":"#for-users-of-the-project-that-sponsor","text":"The project will be hosted for you. The hosted version will always be the latest release and automatically updated. You'll also receive a staging environment with the latest (nightly/beta) build, to see new features before anyone else. You will receive priority on support issues reported on Github. You will be able to make 1 priortized feature request per month. Sponsorship allows me to sink some more time into this project and keep it free, so please consider it. :)","title":"For users of the project that sponsor:"},{"location":"#for-company-sponsors-depending-on-sponsor-level-you-can-get-the-following-benefits","text":"Your company logo will be featured on this readme page at the top. Your company logo will be featured on https://cyberdrain.com A small version of your company logo with a link to your homepage will be on the footer, each user will see this on each page.","title":"For company sponsors, depending on sponsor level you can get the following benefits;"},{"location":"#what-is-the-functionality","text":"The current build functionality is described below, also check out our Changelog in the documentation folder. Any unmarked items are in development.","title":"What is the functionality?"},{"location":"#general","text":"Allow adding/removing tenants to skip Create two user levels for access to settings: User and Admin, Admin can add exclusions/remove exclusions/access complete logs. Allow export of logs to SIEM/External SOC","title":"General"},{"location":"#applications","text":"List all applications in tenants List installation status of a specific application per device Add/Remove custom applications via win32(intunewin) to multiple tenants Add Office Apps to multiple tenants Add/Remove Chocolatey Apps to multiple tenants Add/Remove Ninite Pro Apps to multiple tenants Assign Apps to All Devices or All Users Report on installation status Assign apps to specific groups","title":"Applications"},{"location":"#devices","text":"Add autopilot configuration Add Enrollment Status Pages Add Autopilot Devices Add Administrative templates / Policies","title":"Devices"},{"location":"#users","text":"List all administered users with tenant filtering options Convert user to shared mailbox View/edit licenses List users Add/Remove users to groups User alerting","title":"Users"},{"location":"#tenant-administration","text":"Deploy any custom graph command Set selected defaults across selected tenants Monitor defaults across tenants. Tenant Alerting","title":"Tenant Administration"},{"location":"#security","text":"Authentication is handled by Azure AD using static web apps security. This means the API is only reachable for authenticated users you've invited. For most of the security info related to that check out our staticwebapp.config.json and/or the doc pages on static web apps. Do you see something that might be a security risk, even the smallest? report it and we will handle it asap. Check out our security reporting options","title":"Security"},{"location":"#contributions","text":"Feel free to send pull requests or fill out issues when you encounter them, sponsors get a priority on issues and bugs. I'm also completely open to adding direct maintainers/contributors and working together. If you decide to contribute; remember that keeping the portal fast is a key component. CIPP is supposed to go brrrrr, any improvements that help with speed are welcomed.","title":"Contributions"},{"location":"#welcomed-changescontributions-in-no-particular-order","text":"the code quality and repetive code on the functions can use some work HTML and JQuery definitely needs consolidation and improvement, as I am not a web developer I did what I could... :) Spelling and grammar check, both of APIs and the actual text.","title":"Welcomed changes/contributions in no particular order"},{"location":"#special-thanks","text":"I'd like to give special thanks to the people that made this project possible; Kyle Hansloven Ray Orsini The Team at MSP.zone/MSP'R'Us Gavin Stone at MSPGeek MSP2.0 for helping with some visual input. Scott, Chris, Jon, and others that helped me with some of the internals of the app.","title":"Special thanks"},{"location":"CIPPSettings/BackendAccess/","text":"Backend access \u00b6 You can gain access to the Azure backend by browsing to your Azure Portal. We also include an easy way to jump to the correct locations via the configuration settings -> Security page. Clicking on \"Get backend URLS\" gives you all the important URLs for your specific environment. Resource group \u00b6 This is the location of all your resources. Key vault \u00b6 This is your password storage, if you want to change your keys manually this can be done here. CIPP rotates these keys automatically each Sunday. Function application \u00b6 The overview page alows you to stop the API, or restart it. The configuration page allows you to change settings. If you want to set the timezone, check out this URL. The deployment center allows you to sync the API to the latest version Static webapp \u00b6 Custom domains brings you to the location where you can change the custom domains Role management allows you to invite users, and set the roles for users.","title":"Backend Access"},{"location":"CIPPSettings/BackendAccess/#backend-access","text":"You can gain access to the Azure backend by browsing to your Azure Portal. We also include an easy way to jump to the correct locations via the configuration settings -> Security page. Clicking on \"Get backend URLS\" gives you all the important URLs for your specific environment.","title":"Backend access"},{"location":"CIPPSettings/BackendAccess/#resource-group","text":"This is the location of all your resources.","title":"Resource group"},{"location":"CIPPSettings/BackendAccess/#key-vault","text":"This is your password storage, if you want to change your keys manually this can be done here. CIPP rotates these keys automatically each Sunday.","title":"Key vault"},{"location":"CIPPSettings/BackendAccess/#function-application","text":"The overview page alows you to stop the API, or restart it. The configuration page allows you to change settings. If you want to set the timezone, check out this URL. The deployment center allows you to sync the API to the latest version","title":"Function application"},{"location":"CIPPSettings/BackendAccess/#static-webapp","text":"Custom domains brings you to the location where you can change the custom domains Role management allows you to invite users, and set the roles for users.","title":"Static webapp"},{"location":"CIPPSettings/ConfigurationSettings/","text":"Settings pages \u00b6 You can access diagnostic information, helpful links, check configuration and more from the CIPP Settings section by accessing the Configuration settings menu item. Permissions Settings \u00b6 You can use the \"Run permissions check\" button to check that your CIPP Azure AD Application has the correct permissions assigned. Tenant, Best Practice and Domain Analyser Cache \u00b6 You can clear the cached information used by the tenant selector, best practices analyser and domain analyser features. Tenant Access Check \u00b6 You can check that the required access and configuration is in place for specific tenants using the tenant selector and \"Run access check\" button. Excluded Tenants \u00b6 You can add tenants to the excluded tenant list to prevent CIPP from taking any action against these tenants, removing them from display. Access backend \u00b6 You can get the URLs to access backend features directly in the Azure AD portal from the Security tab. Current known issues / Limitations \u00b6 Only the Excluded Tenants page is active.","title":"Configuration Settings"},{"location":"CIPPSettings/ConfigurationSettings/#settings-pages","text":"You can access diagnostic information, helpful links, check configuration and more from the CIPP Settings section by accessing the Configuration settings menu item.","title":"Settings pages"},{"location":"CIPPSettings/ConfigurationSettings/#permissions-settings","text":"You can use the \"Run permissions check\" button to check that your CIPP Azure AD Application has the correct permissions assigned.","title":"Permissions Settings"},{"location":"CIPPSettings/ConfigurationSettings/#tenant-best-practice-and-domain-analyser-cache","text":"You can clear the cached information used by the tenant selector, best practices analyser and domain analyser features.","title":"Tenant, Best Practice and Domain Analyser Cache"},{"location":"CIPPSettings/ConfigurationSettings/#tenant-access-check","text":"You can check that the required access and configuration is in place for specific tenants using the tenant selector and \"Run access check\" button.","title":"Tenant Access Check"},{"location":"CIPPSettings/ConfigurationSettings/#excluded-tenants","text":"You can add tenants to the excluded tenant list to prevent CIPP from taking any action against these tenants, removing them from display.","title":"Excluded Tenants"},{"location":"CIPPSettings/ConfigurationSettings/#access-backend","text":"You can get the URLs to access backend features directly in the Azure AD portal from the Security tab.","title":"Access backend"},{"location":"CIPPSettings/ConfigurationSettings/#current-known-issues-limitations","text":"Only the Excluded Tenants page is active.","title":"Current known issues / Limitations"},{"location":"EndpointManagement/AddChocoApp/","text":"Adding a Chocolatey App \u00b6 You can add a Chocolatey app by executing this wizard. The wizard will guide you through the steps. If you have a personal repository you can enter the URL for this repo too. Adding the Chocolatey App is done asynchronously. This means that the wizard will make sure everything is setup, and start the process after you've hit the deploy button. The status of the deployment can be traced through the logs page. The application we upload is this prepared intunewin file with two scripts included - Install.ps1 and uninstall.ps1. Both these scripts install Chocolatey, and run an install or uninstall command. If you are unsure or don't trust the intunewin file, you can always replace this with your own in your fork, you can also download and test, and view the contents of this intunewin file. Current known issues / Limitations \u00b6 None. This should work as expected. If you have any issues. Please report this as a bug.","title":"Add Choco App"},{"location":"EndpointManagement/AddChocoApp/#adding-a-chocolatey-app","text":"You can add a Chocolatey app by executing this wizard. The wizard will guide you through the steps. If you have a personal repository you can enter the URL for this repo too. Adding the Chocolatey App is done asynchronously. This means that the wizard will make sure everything is setup, and start the process after you've hit the deploy button. The status of the deployment can be traced through the logs page. The application we upload is this prepared intunewin file with two scripts included - Install.ps1 and uninstall.ps1. Both these scripts install Chocolatey, and run an install or uninstall command. If you are unsure or don't trust the intunewin file, you can always replace this with your own in your fork, you can also download and test, and view the contents of this intunewin file.","title":"Adding a Chocolatey App"},{"location":"EndpointManagement/AddChocoApp/#current-known-issues-limitations","text":"None. This should work as expected. If you have any issues. Please report this as a bug.","title":"Current known issues / Limitations"},{"location":"EndpointManagement/Applications/","text":"Adding a generic App \u00b6 This is not yet possible in the current release. Current known issues / Limitations \u00b6 None. This should work as expected. If you have any issues. Please report this as a bug.","title":"Applications"},{"location":"EndpointManagement/Applications/#adding-a-generic-app","text":"This is not yet possible in the current release.","title":"Adding a generic App"},{"location":"EndpointManagement/Applications/#current-known-issues-limitations","text":"None. This should work as expected. If you have any issues. Please report this as a bug.","title":"Current known issues / Limitations"},{"location":"EndpointManagement/AutopilotDevices/","text":"Adding Autopilot Devices \u00b6 Adding autopilot devices can be done by following the Wizard using the standard Microsoft Partner APIs. These APIs allow you to add devices in three ways: As a partner, you can register devices to Windows Autopilot using any one of these methods: - Hardware Hash (available from OEM or on-device script) - Combination of Manufacturer, Device Model, Device Serial Number - Windows Product Key ID Current known issues / Limitations \u00b6 The API cannot directly return errors currently, which means that generic errors might appear. We've listed some below. Known error list \u00b6 400 - You've entered incorrect data, check the information and try again 500 - The application does not have access to the partner center","title":"Autopilot Devices"},{"location":"EndpointManagement/AutopilotDevices/#adding-autopilot-devices","text":"Adding autopilot devices can be done by following the Wizard using the standard Microsoft Partner APIs. These APIs allow you to add devices in three ways: As a partner, you can register devices to Windows Autopilot using any one of these methods: - Hardware Hash (available from OEM or on-device script) - Combination of Manufacturer, Device Model, Device Serial Number - Windows Product Key ID","title":"Adding Autopilot Devices"},{"location":"EndpointManagement/AutopilotDevices/#current-known-issues-limitations","text":"The API cannot directly return errors currently, which means that generic errors might appear. We've listed some below.","title":"Current known issues / Limitations"},{"location":"EndpointManagement/AutopilotDevices/#known-error-list","text":"400 - You've entered incorrect data, check the information and try again 500 - The application does not have access to the partner center","title":"Known error list"},{"location":"EndpointManagement/AutopilotProfiles/","text":"Adding Autopilot Profiles \u00b6 This page will allow you to add Autopilot profiles, Autopilot profiles allow you to setup devices exactly how you want them. You can create multiple profiles with this Wizard. Current known issues / Limitations \u00b6 You can only assign one profile to \"All Devices\" Known error list \u00b6 400 - You've entered incorrect data, check the information and try again. You might already have one policy pointed at the \"All Devices\" group.","title":"Autopilot Profiles"},{"location":"EndpointManagement/AutopilotProfiles/#adding-autopilot-profiles","text":"This page will allow you to add Autopilot profiles, Autopilot profiles allow you to setup devices exactly how you want them. You can create multiple profiles with this Wizard.","title":"Adding Autopilot Profiles"},{"location":"EndpointManagement/AutopilotProfiles/#current-known-issues-limitations","text":"You can only assign one profile to \"All Devices\"","title":"Current known issues / Limitations"},{"location":"EndpointManagement/AutopilotProfiles/#known-error-list","text":"400 - You've entered incorrect data, check the information and try again. You might already have one policy pointed at the \"All Devices\" group.","title":"Known error list"},{"location":"EndpointManagement/AutopilotStatusPage/","text":"Adding Autopilot Status Pages \u00b6 This page will allow you to edit the DEFAULT Enrollment Status Page. This page applies to all tenants, all users and devices. Current known issues / Limitations \u00b6 You can only edit the default profile, and not create new ones. Known error list \u00b6 400 - You've entered incorrect data, check the information and try again.","title":"Autopilot Status Page"},{"location":"EndpointManagement/AutopilotStatusPage/#adding-autopilot-status-pages","text":"This page will allow you to edit the DEFAULT Enrollment Status Page. This page applies to all tenants, all users and devices.","title":"Adding Autopilot Status Pages"},{"location":"EndpointManagement/AutopilotStatusPage/#current-known-issues-limitations","text":"You can only edit the default profile, and not create new ones.","title":"Current known issues / Limitations"},{"location":"EndpointManagement/AutopilotStatusPage/#known-error-list","text":"400 - You've entered incorrect data, check the information and try again.","title":"Known error list"},{"location":"EndpointManagement/Defender/","text":"Defender \u00b6 This page lists the defender status Current known issues / Limitations \u00b6 you must be a current Microsoft Lighthouse partner, and your tenants must be onboarded before you can use this. The Microsoft Graph Team is working on resolving a permissions issues, asap. This page might not be able to be used in the meantime.","title":"Defender"},{"location":"EndpointManagement/Defender/#defender","text":"This page lists the defender status","title":"Defender"},{"location":"EndpointManagement/Defender/#current-known-issues-limitations","text":"you must be a current Microsoft Lighthouse partner, and your tenants must be onboarded before you can use this. The Microsoft Graph Team is working on resolving a permissions issues, asap. This page might not be able to be used in the meantime.","title":"Current known issues / Limitations"},{"location":"EndpointManagement/IntunePolicyTemplates/","text":"Deploying policies \u00b6 To create a policy and get it's raw JSON information you'll have to go to the endpoint.microsoft.com portal. Go to Devices -> Configuration Profiles Create a new configuration profile Choose \"Windows 10 and later\" as a platform Choose \"Templates\" and then select any option. Select all the settings you want, remember that there are both computer policies and user policies. at Review and Create, do not click on the \"Create\" button but press F12 on your keyboard to open the developer tools. Now click on \"Create\" and look for the \"UpdateDefiniationValues\" post request for administrative templates, or any other POST request for other templates. Click on \"Headers\" and scroll down to \"request payload\". this is the raw JSON paylow. To easily copy it, click on \"view source\" and copy the entire text string. You can now use CIPP to deploy this policy to all tenants. Current known issues / Limitations \u00b6 All templates are currently supported, if you do not see your template type in the list, you must select Custom Configuration When using Settings Catalog or Custom Configuration, the Display Name and Description are using from the raw JSON file.","title":"Intune Policy Templates"},{"location":"EndpointManagement/IntunePolicyTemplates/#deploying-policies","text":"To create a policy and get it's raw JSON information you'll have to go to the endpoint.microsoft.com portal. Go to Devices -> Configuration Profiles Create a new configuration profile Choose \"Windows 10 and later\" as a platform Choose \"Templates\" and then select any option. Select all the settings you want, remember that there are both computer policies and user policies. at Review and Create, do not click on the \"Create\" button but press F12 on your keyboard to open the developer tools. Now click on \"Create\" and look for the \"UpdateDefiniationValues\" post request for administrative templates, or any other POST request for other templates. Click on \"Headers\" and scroll down to \"request payload\". this is the raw JSON paylow. To easily copy it, click on \"view source\" and copy the entire text string. You can now use CIPP to deploy this policy to all tenants.","title":"Deploying policies"},{"location":"EndpointManagement/IntunePolicyTemplates/#current-known-issues-limitations","text":"All templates are currently supported, if you do not see your template type in the list, you must select Custom Configuration When using Settings Catalog or Custom Configuration, the Display Name and Description are using from the raw JSON file.","title":"Current known issues / Limitations"},{"location":"GettingStarted/Changelog/","text":"Changelog \u00b6 All notable changes to this project will be documented in this file. The format is based on Keep a Changelog , and this project adheres to Semantic Versioning . 1.3.0 - Codename \"Gin\" - 2021-11-05 \u00b6 View the release notes on GitHub 1.2.1 - 2021-10-28 \u00b6 View the release notes on GitHub 1.2.0 - 2021-10-27 \u00b6 View the release notes on GitHub 1.1.0 - 2021-10-20 \u00b6 View the release notes on GitHub 1.0.0 - 2021-10-13 - 17 hours and 14 minutes of development time \u00b6 Added \u00b6 Everything. First release Contact Microsoft for CSP sandbox, testing environment and documentation on how to work with specific APIs: 1 hour Actual development time: 16 hours","title":"Changelog"},{"location":"GettingStarted/Changelog/#changelog","text":"All notable changes to this project will be documented in this file. The format is based on Keep a Changelog , and this project adheres to Semantic Versioning .","title":"Changelog"},{"location":"GettingStarted/Changelog/#130-codename-gin-2021-11-05","text":"View the release notes on GitHub","title":"1.3.0 - Codename \"Gin\" - 2021-11-05"},{"location":"GettingStarted/Changelog/#121-2021-10-28","text":"View the release notes on GitHub","title":"1.2.1 - 2021-10-28"},{"location":"GettingStarted/Changelog/#120-2021-10-27","text":"View the release notes on GitHub","title":"1.2.0 - 2021-10-27"},{"location":"GettingStarted/Changelog/#110-2021-10-20","text":"View the release notes on GitHub","title":"1.1.0 - 2021-10-20"},{"location":"GettingStarted/Changelog/#100-2021-10-13-17-hours-and-14-minutes-of-development-time","text":"","title":"1.0.0 - 2021-10-13 - 17 hours and 14 minutes of development time"},{"location":"GettingStarted/Changelog/#added","text":"Everything. First release Contact Microsoft for CSP sandbox, testing environment and documentation on how to work with specific APIs: 1 hour Actual development time: 16 hours","title":"Added"},{"location":"GettingStarted/Contributions/","text":"Contributing \u00b6 Contributions to CIPP are welcome by everyone. There's a couple of things to keep in mind; These repositories are going through rapid changes. Every pull request should update version_latest.txt with versioning that follows https://semver.org Speed and Security are two of our pillars, if it isn't fast, it isn't good, and if it isn't secure, it can't be accepted :) We try to use native APIs over Powershell Modules. Powershell modules tend to slow the entire processing. We currently only have Az.Keyvault and Az.Accounts loaded and prefer to keep it that way. The interface is made entirely in Bootstrap and Jquery. For Datatables we use the JQuery Datatables plugin. Avoid adding a deploy YML to your development repo. We'll remove those, but it's just an annoyance. If you want to both deploy and develop it's better to create two instances of the repo. When contributing, or planning to contribute, please create an issue in the tracker here . If you are fixing a bug, file a complete bug report and assign it to yourself, if you are adding a feature, please add \"Feature Request\" to the title and assign it to yourself. Feature requests \u00b6 Feature requests that request integration with anything but M365 will be closed. We're not integrating directly with third party products until version 2.0. Pull requests that have integration components will be discussed and evaluated on a case-by-case basis. Pull Requests \u00b6 We do not accept PRs or commits against Master. Master is always the final version. For both CIPP and CIPP-API we have two branches. Dev and Master. Please make any PR against Dev, when Dev is promoted to final we'll PR that against master. Naming Standards \u00b6 We follow a naming standard, as based on the name a user might get access to an API or not. Our current naming standard is as follows; ListBla - Everything that generates a list (users) EditBla - Anything that edits an exisiting object (edit user) AddBla - Anything that adds an object (add user) RemoveBla - Anything that deletes or removes an object (remove user) ExecBla - Anything that executes an action (send mfa request to user) Creating two instances \u00b6 Make a clone of your forked repo Optional: mark this repo as private Add the following github action, this will sync the repos every hour: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # This is a basic workflow that is manually triggered name: Pull from master schedule # Controls when the action will run. Workflow runs when manually triggered using the UI # or API. on: schedule: # * is a special character in YAML so you have to quote this string - cron: '0 * * * *' # Inputs the workflow accepts. # A workflow run is made up of one or more jobs that can run sequentially or in parallel jobs: repo-sync: runs-on: ubuntu-latest steps: - uses: actions/checkout@v2 with: persist-credentials: false - name: repo-sync uses: repo-sync/github-sync@v2 with: source_repo: \"KelvinTegelaar/CIPP\" source_branch: \"master\" destination_branch: \"master\" github_token: ${{ secrets.PAT }} Go to settings of the repo click on add secret secret name \"PAT\" Secret value: a self created personal access token(https://github.com/settings/tokens) Local development guide \u00b6 So you want to jump in on helping us make this awesome? You'll need a local development environment. I'm assuming you have some programming experience. You'll need a couple of tools to get started Install node.js Install .NET Core 2 SDK and .NET Core 5 SDK After installation execute the following commands: 1 2 npm install -g @azure/static-web-apps-cli npm install -g azure-functions-core-tools@3 After these are installed, you can start a local development instance of the Azure Functions(APIs) the Static web app(Frontend) or both Starting only the frontend: 1 swa start \"C:\\PathToYourLocallyDownloadedFrontEn\" --swa-config-location \"C:\\AnyInvalidPath\" We use an invalid path on purpose, because our config in the CIPP folder only works for cloud engines and not the local emulator. Starting only the APIs: 1 2 3 4 func start --script-root \"C:\\FolderTo\\CIPP-API\" ``` For starting both, we recommend two separate instances. You can also have the SWA utility start the API but this brings in some added difficulties because you can't see the API logs directly in the console. func start --script-root \"C:\\FolderTo\\CIPP-API\" swa start \"C:\\PathToYourLocallyDownloadedFrontEn\" --swa-config-location \"C:\\AnyInvalidPath\" --api-location http://localhost:7071/ ``` If you need the APIs to connect to M365 and use the secure application model you'll also need to make a local.settings.json file inside of the CIPP-API folder. This file is added to .gitignore so it will not be pushed. This file contains the secure application model keys, and a Azure Storage connection string for the durable function queues. Local.settings.json example: 1 2 3 4 5 6 7 8 9 10 11 12 13 { \"IsEncrypted\" : false , \"Values\" : { \"FUNCTIONS_WORKER_RUNTIME\" : \"powershell\" , \"FUNCTIONS_WORKER_RUNTIME_VERSION\" : \"~7\" , \"AzureWebJobsStorage\" : \"DefaultEndpointsProtocol=AzureStorageConnectionStringhere\" , \"applicationid\" : \"appid\" , \"applicationsecret\" : \"applicationsecret\" , \"refreshtoken\" : \"refreshtoken\" , \"exchangerefreshtoken\" : \"exchangerefresh\" , \"tenantid\" : \"tenantid\" } }","title":"Contributions"},{"location":"GettingStarted/Contributions/#contributing","text":"Contributions to CIPP are welcome by everyone. There's a couple of things to keep in mind; These repositories are going through rapid changes. Every pull request should update version_latest.txt with versioning that follows https://semver.org Speed and Security are two of our pillars, if it isn't fast, it isn't good, and if it isn't secure, it can't be accepted :) We try to use native APIs over Powershell Modules. Powershell modules tend to slow the entire processing. We currently only have Az.Keyvault and Az.Accounts loaded and prefer to keep it that way. The interface is made entirely in Bootstrap and Jquery. For Datatables we use the JQuery Datatables plugin. Avoid adding a deploy YML to your development repo. We'll remove those, but it's just an annoyance. If you want to both deploy and develop it's better to create two instances of the repo. When contributing, or planning to contribute, please create an issue in the tracker here . If you are fixing a bug, file a complete bug report and assign it to yourself, if you are adding a feature, please add \"Feature Request\" to the title and assign it to yourself.","title":"Contributing"},{"location":"GettingStarted/Contributions/#feature-requests","text":"Feature requests that request integration with anything but M365 will be closed. We're not integrating directly with third party products until version 2.0. Pull requests that have integration components will be discussed and evaluated on a case-by-case basis.","title":"Feature requests"},{"location":"GettingStarted/Contributions/#pull-requests","text":"We do not accept PRs or commits against Master. Master is always the final version. For both CIPP and CIPP-API we have two branches. Dev and Master. Please make any PR against Dev, when Dev is promoted to final we'll PR that against master.","title":"Pull Requests"},{"location":"GettingStarted/Contributions/#naming-standards","text":"We follow a naming standard, as based on the name a user might get access to an API or not. Our current naming standard is as follows; ListBla - Everything that generates a list (users) EditBla - Anything that edits an exisiting object (edit user) AddBla - Anything that adds an object (add user) RemoveBla - Anything that deletes or removes an object (remove user) ExecBla - Anything that executes an action (send mfa request to user)","title":"Naming Standards"},{"location":"GettingStarted/Contributions/#creating-two-instances","text":"Make a clone of your forked repo Optional: mark this repo as private Add the following github action, this will sync the repos every hour: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # This is a basic workflow that is manually triggered name: Pull from master schedule # Controls when the action will run. Workflow runs when manually triggered using the UI # or API. on: schedule: # * is a special character in YAML so you have to quote this string - cron: '0 * * * *' # Inputs the workflow accepts. # A workflow run is made up of one or more jobs that can run sequentially or in parallel jobs: repo-sync: runs-on: ubuntu-latest steps: - uses: actions/checkout@v2 with: persist-credentials: false - name: repo-sync uses: repo-sync/github-sync@v2 with: source_repo: \"KelvinTegelaar/CIPP\" source_branch: \"master\" destination_branch: \"master\" github_token: ${{ secrets.PAT }} Go to settings of the repo click on add secret secret name \"PAT\" Secret value: a self created personal access token(https://github.com/settings/tokens)","title":"Creating two instances"},{"location":"GettingStarted/Contributions/#local-development-guide","text":"So you want to jump in on helping us make this awesome? You'll need a local development environment. I'm assuming you have some programming experience. You'll need a couple of tools to get started Install node.js Install .NET Core 2 SDK and .NET Core 5 SDK After installation execute the following commands: 1 2 npm install -g @azure/static-web-apps-cli npm install -g azure-functions-core-tools@3 After these are installed, you can start a local development instance of the Azure Functions(APIs) the Static web app(Frontend) or both Starting only the frontend: 1 swa start \"C:\\PathToYourLocallyDownloadedFrontEn\" --swa-config-location \"C:\\AnyInvalidPath\" We use an invalid path on purpose, because our config in the CIPP folder only works for cloud engines and not the local emulator. Starting only the APIs: 1 2 3 4 func start --script-root \"C:\\FolderTo\\CIPP-API\" ``` For starting both, we recommend two separate instances. You can also have the SWA utility start the API but this brings in some added difficulties because you can't see the API logs directly in the console. func start --script-root \"C:\\FolderTo\\CIPP-API\" swa start \"C:\\PathToYourLocallyDownloadedFrontEn\" --swa-config-location \"C:\\AnyInvalidPath\" --api-location http://localhost:7071/ ``` If you need the APIs to connect to M365 and use the secure application model you'll also need to make a local.settings.json file inside of the CIPP-API folder. This file is added to .gitignore so it will not be pushed. This file contains the secure application model keys, and a Azure Storage connection string for the durable function queues. Local.settings.json example: 1 2 3 4 5 6 7 8 9 10 11 12 13 { \"IsEncrypted\" : false , \"Values\" : { \"FUNCTIONS_WORKER_RUNTIME\" : \"powershell\" , \"FUNCTIONS_WORKER_RUNTIME_VERSION\" : \"~7\" , \"AzureWebJobsStorage\" : \"DefaultEndpointsProtocol=AzureStorageConnectionStringhere\" , \"applicationid\" : \"appid\" , \"applicationsecret\" : \"applicationsecret\" , \"refreshtoken\" : \"refreshtoken\" , \"exchangerefreshtoken\" : \"exchangerefresh\" , \"tenantid\" : \"tenantid\" } }","title":"Local development guide"},{"location":"GettingStarted/FAQ/","text":"Installation Questions \u00b6 Why can't I install CIPP using the \"Deploy to Azure\" button? If you're experiencing issues with installation please report these in #cipp-issues on the CIPP Discord Why can't I get details for a particular tenant / any tenants? If you have a guest account in a tenant that has the same UPN as you used to generate your tokens - you will experience issues. Conditional access may block the correct functioning of the tokens - check your CA policies and also make sure you're not geo-blocking the function app's location. You cannot use third party MFA on the account used to generate SAM tokens. Token test script You can use the script below to test your tokens: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 $ApplicationID = \"YourAppID\" $applicationsecret = \"yourappsecret\" $refreshtoken = \"YourRefreshToken\" $MyTenant = \"YourPartnertenant.onmicrosoft.com\" function Connect-graphAPI { [ CmdletBinding ()] Param ( [ parameter ( Position = 0 , Mandatory = $false )] [ ValidateNotNullOrEmpty ()] [String] $ApplicationId , [ parameter ( Position = 1 , Mandatory = $false )] [ ValidateNotNullOrEmpty ()] [String] $ApplicationSecret , [ parameter ( Position = 2 , Mandatory = $true )] [ ValidateNotNullOrEmpty ()] [String] $TenantID , [ parameter ( Position = 3 , Mandatory = $false )] [ ValidateNotNullOrEmpty ()] [String] $RefreshToken ) Write-Verbose \"Removing old token if it exists\" $Script:GraphHeader = $null Write-Verbose \"Logging into Graph API\" try { if ( $ApplicationId ) { Write-Verbose \" using the entered credentials\" $script:ApplicationId = $ApplicationId $script:ApplicationSecret = $ApplicationSecret $script:RefreshToken = $RefreshToken $AuthBody = @{ client_id = $ApplicationId client_secret = $ApplicationSecret scope = 'https://graph.microsoft.com/.default' refresh_token = $RefreshToken grant_type = \"refresh_token\" } } else { Write-Verbose \" using the cached credentials\" $AuthBody = @{ client_id = $script:ApplicationId client_secret = $Script:ApplicationSecret scope = 'https://graph.microsoft.com/.default' refresh_token = $script:RefreshToken grant_type = \"refresh_token\" } } $AccessToken = ( Invoke-RestMethod -Method post -Uri \"https://login.microsoftonline.com/ $( $tenantid ) /oauth2/v2.0/token\" -Body $Authbody -ErrorAction Stop ). access_token $Script:GraphHeader = @{ Authorization = \"Bearer $( $AccessToken ) \" } } catch { write-error \"Could not log into the Graph API for tenant $( $TenantID ) : $( $_ . Exception . Message ) \" } } write-host \"Generating token to log into Intune\" -ForegroundColor Green Connect-graphAPI -ApplicationId $applicationid -ApplicationSecret $applicationsecret -RefreshToken $refreshtoken -TenantID $MyTenant $Tenants = ( Invoke-RestMethod -Uri \"https://graph.microsoft.com/v1.0/contracts? `$ top=999\" -Method GET -Headers $script:GraphHeader ). value foreach ( $Tenant in $Tenants ) { Connect-graphAPI -ApplicationId $applicationid -ApplicationSecret $applicationsecret -RefreshToken $refreshtoken -TenantID $tenant . customerid ( Invoke-RestMethod -Uri \"https://graph.microsoft.com/v1.0/users\" -Method GET -Headers $script:GraphHeader ). value } If your entire tenant list does not load, there is a big chance there is something wrong with your token configuration. Execute the permissions check in the Configuration Settings and see if that succeeds. If the permissions check fails you have either made a typo, have not performed all consents, or you are being blocked by conditional access. To reload the keys you can go to configuration settings -> security -> Backend access and click on the keyvault. Give your user permissions to change and read the keys. Correct the keys if required by uploading a new version. After uploading a new version your old keys will still be cached by the function app. Go to configuration settings -> security -> Backend access and click on \"Function App (configuration). This leads you to a configuration page. Rename the variable you've changed temporarily. For example if you have renamed \"TenantID\" you can rename \"TenantID\" to \"TenantID2\" temporarily. Now restart the function app via the overview page. Go back to the configuration page and revert to the original name of the variable. Restart the application once more and it will no longer use the cached version.","title":"Frequently Asked Questions"},{"location":"GettingStarted/FAQ/#installation-questions","text":"Why can't I install CIPP using the \"Deploy to Azure\" button? If you're experiencing issues with installation please report these in #cipp-issues on the CIPP Discord Why can't I get details for a particular tenant / any tenants? If you have a guest account in a tenant that has the same UPN as you used to generate your tokens - you will experience issues. Conditional access may block the correct functioning of the tokens - check your CA policies and also make sure you're not geo-blocking the function app's location. You cannot use third party MFA on the account used to generate SAM tokens. Token test script You can use the script below to test your tokens: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 $ApplicationID = \"YourAppID\" $applicationsecret = \"yourappsecret\" $refreshtoken = \"YourRefreshToken\" $MyTenant = \"YourPartnertenant.onmicrosoft.com\" function Connect-graphAPI { [ CmdletBinding ()] Param ( [ parameter ( Position = 0 , Mandatory = $false )] [ ValidateNotNullOrEmpty ()] [String] $ApplicationId , [ parameter ( Position = 1 , Mandatory = $false )] [ ValidateNotNullOrEmpty ()] [String] $ApplicationSecret , [ parameter ( Position = 2 , Mandatory = $true )] [ ValidateNotNullOrEmpty ()] [String] $TenantID , [ parameter ( Position = 3 , Mandatory = $false )] [ ValidateNotNullOrEmpty ()] [String] $RefreshToken ) Write-Verbose \"Removing old token if it exists\" $Script:GraphHeader = $null Write-Verbose \"Logging into Graph API\" try { if ( $ApplicationId ) { Write-Verbose \" using the entered credentials\" $script:ApplicationId = $ApplicationId $script:ApplicationSecret = $ApplicationSecret $script:RefreshToken = $RefreshToken $AuthBody = @{ client_id = $ApplicationId client_secret = $ApplicationSecret scope = 'https://graph.microsoft.com/.default' refresh_token = $RefreshToken grant_type = \"refresh_token\" } } else { Write-Verbose \" using the cached credentials\" $AuthBody = @{ client_id = $script:ApplicationId client_secret = $Script:ApplicationSecret scope = 'https://graph.microsoft.com/.default' refresh_token = $script:RefreshToken grant_type = \"refresh_token\" } } $AccessToken = ( Invoke-RestMethod -Method post -Uri \"https://login.microsoftonline.com/ $( $tenantid ) /oauth2/v2.0/token\" -Body $Authbody -ErrorAction Stop ). access_token $Script:GraphHeader = @{ Authorization = \"Bearer $( $AccessToken ) \" } } catch { write-error \"Could not log into the Graph API for tenant $( $TenantID ) : $( $_ . Exception . Message ) \" } } write-host \"Generating token to log into Intune\" -ForegroundColor Green Connect-graphAPI -ApplicationId $applicationid -ApplicationSecret $applicationsecret -RefreshToken $refreshtoken -TenantID $MyTenant $Tenants = ( Invoke-RestMethod -Uri \"https://graph.microsoft.com/v1.0/contracts? `$ top=999\" -Method GET -Headers $script:GraphHeader ). value foreach ( $Tenant in $Tenants ) { Connect-graphAPI -ApplicationId $applicationid -ApplicationSecret $applicationsecret -RefreshToken $refreshtoken -TenantID $tenant . customerid ( Invoke-RestMethod -Uri \"https://graph.microsoft.com/v1.0/users\" -Method GET -Headers $script:GraphHeader ). value } If your entire tenant list does not load, there is a big chance there is something wrong with your token configuration. Execute the permissions check in the Configuration Settings and see if that succeeds. If the permissions check fails you have either made a typo, have not performed all consents, or you are being blocked by conditional access. To reload the keys you can go to configuration settings -> security -> Backend access and click on the keyvault. Give your user permissions to change and read the keys. Correct the keys if required by uploading a new version. After uploading a new version your old keys will still be cached by the function app. Go to configuration settings -> security -> Backend access and click on \"Function App (configuration). This leads you to a configuration page. Rename the variable you've changed temporarily. For example if you have renamed \"TenantID\" you can rename \"TenantID\" to \"TenantID2\" temporarily. Now restart the function app via the overview page. Go back to the configuration page and revert to the original name of the variable. Restart the application once more and it will no longer use the cached version.","title":"Installation Questions"},{"location":"GettingStarted/Installation/","text":"Prerequisites \u00b6 For the installation and maintenance, we assume you have some knowledge of GitHub (or Git in general), and have setup the Secure Application Model prior to install. Haven't setup the Secure Application model yet? Check out this CyberDrain blog post . For a step-by-step guide to setting up the Secure Application Model, see this Gavsto blog post . Just the code. If you're just looking for the SAM script - you can find it below: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 Param ( [ Parameter ( Mandatory = $false )] [switch] $ConfigurePreconsent , [ Parameter ( Mandatory = $true )] [string] $DisplayName , [ Parameter ( Mandatory = $false )] [string] $TenantId ) $ErrorActionPreference = \"Stop\" # Check if the Azure AD PowerShell module has already been loaded. if ( ! ( Get-Module AzureAD ) ) { # Check if the Azure AD PowerShell module is installed. if ( Get-Module -ListAvailable -Name AzureAD ) { # The Azure AD PowerShell module is not load and it is installed. This module # must be loaded for other operations performed by this script. Write-Host -ForegroundColor Green \"Loading the Azure AD PowerShell module...\" Import-Module AzureAD } else { Install-Module AzureAD } } try { Write-Host -ForegroundColor Green \"When prompted please enter the appropriate credentials... Warning: Window might have pop-under in VSCode\" if ( [string] :: IsNullOrEmpty ( $TenantId )) { Connect-AzureAD | Out-Null $TenantId = $( Get-AzureADTenantDetail ). ObjectId } else { Connect-AzureAD -TenantId $TenantId | Out-Null } } catch [Microsoft.Azure.Common.Authentication.AadAuthenticationCanceledException] { # The authentication attempt was canceled by the end-user. Execution of the script should be halted. Write-Host -ForegroundColor Yellow \"The authentication attempt was canceled. Execution of the script will be halted...\" Exit } catch { # An unexpected error has occurred. The end-user should be notified so that the appropriate action can be taken. Write-Error \"An unexpected error has occurred. Please review the following error message and try again.\" ` \" $( $Error [ 0 ]. Exception ) \" } $adAppAccess = [Microsoft.Open.AzureAD.Model.RequiredResourceAccess] @{ ResourceAppId = \"00000002-0000-0000-c000-000000000000\" ; ResourceAccess = [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"5778995a-e1bf-45b8-affa-663a9f3f4d04\" ; Type = \"Role\" }, [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"a42657d6-7f20-40e3-b6f0-cee03008a62a\" ; Type = \"Scope\" }, [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"311a71cc-e848-46a1-bdf8-97ff7156d8e6\" ; Type = \"Scope\" } } $graphAppAccess = [Microsoft.Open.AzureAD.Model.RequiredResourceAccess] @{ ResourceAppId = \"00000003-0000-0000-c000-000000000000\" ; ResourceAccess = [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"bf394140-e372-4bf9-a898-299cfc7564e5\" ; Type = \"Role\" }, [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"7ab1d382-f21e-4acd-a863-ba3e13f7da61\" ; Type = \"Role\" } } $partnerCenterAppAccess = [Microsoft.Open.AzureAD.Model.RequiredResourceAccess] @{ ResourceAppId = \"fa3d9a0c-3fb0-42cc-9193-47c7ecd2edbd\" ; ResourceAccess = [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"1cebfa2a-fb4d-419e-b5f9-839b4383e05a\" ; Type = \"Scope\" } } $SessionInfo = Get-AzureADCurrentSessionInfo Write-Host -ForegroundColor Green \"Creating the Azure AD application and related resources...\" $app = New-AzureADApplication -AvailableToOtherTenants $true -DisplayName $DisplayName -IdentifierUris \"https:// $( $SessionInfo . TenantDomain ) / $(( New-Guid ). ToString ()) \" -RequiredResourceAccess $adAppAccess , $graphAppAccess , $partnerCenterAppAccess -ReplyUrls @( \"urn:ietf:wg:oauth:2.0:oob\" , \"https://login.microsoftonline.com/organizations/oauth2/nativeclient\" , \"https://localhost\" , \"http://localhost\" , \"http://localhost:8400\" ) $password = New-AzureADApplicationPasswordCredential -ObjectId $app . ObjectId $spn = New-AzureADServicePrincipal -AppId $app . AppId -DisplayName $DisplayName $adminAgentsGroup = Get-AzureADGroup -Filter \"DisplayName eq 'AdminAgents'\" Add-AzureADGroupMember -ObjectId $adminAgentsGroup . ObjectId -RefObjectId $spn . ObjectId write-host \"Installing PartnerCenter Module.\" -ForegroundColor Green install-module PartnerCenter -Force write-host \"Sleeping for 30 seconds to allow app creation on O365\" -foregroundcolor green start-sleep 30 write-host \"Please approve General consent form.\" -ForegroundColor Green $PasswordToSecureString = $password . value | ConvertTo-SecureString -asPlainText -Force $credential = New-Object System . Management . Automation . PSCredential ($( $app . AppId ), $PasswordToSecureString ) $token = New-PartnerAccessToken -ApplicationId \" $( $app . AppId ) \" -Scopes 'https://api.partnercenter.microsoft.com/user_impersonation' -ServicePrincipal -Credential $credential -Tenant $( $spn . AppOwnerTenantID ) -UseAuthorizationCode write-host \"Please approve Exchange consent form.\" -ForegroundColor Green $Exchangetoken = New-PartnerAccessToken -ApplicationId 'a0c73c16-a7e3-4564-9a95-2bdf47383716' -Scopes 'https://outlook.office365.com/.default' -Tenant $( $spn . AppOwnerTenantID ) -UseDeviceAuthentication write-host \"Last initation required: Please browse to https://login.microsoftonline.com/ $( $spn . AppOwnerTenantID ) /adminConsent?client_id= $( $app . AppId ) \" write-host \"Press any key after auth. An error report about incorrect URIs is expected!\" [void][System.Console] :: ReadKey ( $true ) Write-Host \"================ Secrets ================\" Write-Host \" `$ ApplicationId = $( $app . AppId ) \" Write-Host \" `$ ApplicationSecret = $( $password . Value ) \" Write-Host \" `$ TenantID = $( $spn . AppOwnerTenantID ) \" write-host \" `$ RefreshToken = $( $token . refreshtoken ) \" -ForegroundColor Blue write-host \" `$ Exchange RefreshToken = $( $ExchangeToken . Refreshtoken ) \" -ForegroundColor Green Write-Host \"================ Secrets ================\" Write-Host \" SAVE THESE IN A SECURE LOCATION \" You'll also need the following permissions for your secure application model, to add permissions follow these instructions: Go to the Azure Portal . Click on Azure Active Directory , now click on App Registrations . Find your Secure App Model application. You can search based on the Application ID. Go to API Permissions and click Add a permission . Choose \u201cMicrosoft Graph\u201d and \u201cDelegated permission\u201d or \"Application Permissions\" Add the permission you need Finally, click on \u201cGrant Admin Consent\u201d for Company Name. Permissions \u00b6 For full functionality, you'll need the following permissions for your Secure Application Model. You can remove any permissions if you do not want the application to be able to use that functionality. Duplicate Permissions Some permissions may appear to be duplicated in the Delegated and Application permissions tables below. This is by design and you do need to add both permissions! Delegated Permissions \u00b6 You'll need to add the following Delegated permissions : API / Permissions name Description Application.Read.All Read applications Application.ReadWrite.All Read and write all applications AuditLog.Read.All Read audit log data Channel.Create Create channels Channel.ReadBasic.All Read the names and descriptions of channels ChannelMember.Read.All Read the members of channels ChannelMember.ReadWrite.All Add and remove members from channels ChannelMessage.Delete Delete users' channel messages ChannelMessage.Edit Edit users' channel messages ChannelMessage.Read.All Read users' channel messages ChannelMessage.Send Send channel messages ChannelSettings.Read.All Read the names, descriptions, and settings of channels ChannelSettings.ReadWrite.All Read and write the names, descriptions, and settings of channels ConsentRequest.Read.All Read consent requests Device.Command Communicate with user devices Device.Read Read user devices Device.Read.All Read all devices DeviceManagementApps.ReadWrite.All Read and write Microsoft Intune apps DeviceManagementConfiguration.ReadWrite.All Read and write Microsoft Intune Device Configuration and Policies DeviceManagementManagedDevices.ReadWrite.All Read and write Microsoft Intune devices DeviceManagementRBAC.ReadWrite.All Read and write Microsoft Intune RBAC settings DeviceManagementServiceConfig.ReadWrite.All Read and write Microsoft Intune configuration Directory.AccessAsUser.All Access directory as the signed in user Domain.Read.All Read domain data Group.ReadWrite.All Read and write all groups GroupMember.ReadWrite.All Read and write group memberships Mail.Send Send mail as a user Mail.Send.Shared Send mail on behalf of others Member.Read.Hidden Read hidden memberships Organization.ReadWrite.All Read and write organization information Policy.Read.All Read your organization's policies Policy.ReadWrite.AuthenticationFlows Read and write authentication flow policies Policy.ReadWrite.AuthenticationMethod Read and write authentication method policies Policy.ReadWrite.Authorization Read and write your organization's authorization policy Policy.ReadWrite.ConsentRequest Read and write consent request policy Policy.ReadWrite.ConditionalAccess Read and write conditional access policy Policy.ReadWrite.DeviceConfiguration Read and write your organization's device configuration policies PrivilegedAccess.Read.AzureResources Read privileged access to Azure resources PrivilegedAccess.ReadWrite.AzureResources Read and write privileged access to Azure resources OpenID permissions - profile View users' basic profile Reports.Read.All Read all usage reports RoleManagement.ReadWrite.Directory Read and write directory RBAC settings SecurityActions.ReadWrite.All Read and update your organization's security actions SecurityEvents.ReadWrite.All Read and update your organization\u2019s security events ServiceHealth.Read.All Read service health ServiceMessage.Read.All Read service announcement messages Sites.ReadWrite.All Edit or delete items in all site collections TeamMember.ReadWrite.All Add and remove members from teams TeamMember.ReadWriteNonOwnerRole.All Add and remove members with non-owner role for all teams TeamsActivity.Read Read users' teamwork activity feed TeamsActivity.Send Send a teamwork activity as the user TeamsApp.Read Read users' installed Teams apps TeamsApp.Read.All Read all installed Teams apps TeamsApp.ReadWrite Manage users' Teams apps TeamsApp.ReadWrite.All Manage all Teams apps TeamsAppInstallation.ReadForChat Read installed Teams apps in chats TeamsAppInstallation.ReadForTeam Read installed Teams apps in teams TeamsAppInstallation.ReadForUser Read users' installed Teams apps TeamsAppInstallation.ReadWriteForChat Manage installed Teams apps in chats TeamsAppInstallation.ReadWriteForTeam Manage installed Teams apps in teams TeamsAppInstallation.ReadWriteForUser Manage users' installed Teams apps TeamsAppInstallation.ReadWriteSelfForChat Allow the Teams app to manage itself in chats TeamsAppInstallation.ReadWriteSelfForTeam Allow the app to manage itself in teams TeamsAppInstallation.ReadWriteSelfForUser Allow the Teams app to manage itself for a user TeamSettings.Read.All Read teams' settings TeamSettings.ReadWrite.All Read and change teams' settings TeamsTab.Create Create tabs in Microsoft Teams TeamsTab.Read.All Read tabs in Microsoft Teams TeamsTab.ReadWrite.All Read and write tabs in Microsoft Teams TeamsTab.ReadWriteForChat Allow the Teams app to manage all tabs in chats TeamsTab.ReadWriteForTeam Allow the Teams app to manage all tabs in teams TeamsTab.ReadWriteForUser Allow the Teams app to manage all tabs for a user Team.Create Create teams Team.ReadBasic.All Read the names and descriptions of teams ThreatAssessment.ReadWrite.All Read and write threat assessment requests UnifiedGroupMember.Read.AsGuest Read unified group memberships as guest User.ManageIdentities.All Manage user identities User.Read Sign in and read user profile User.ReadWrite.All Read and write all users' full profiles UserAuthenticationMethod.Read.All Read all users' authentication methods UserAuthenticationMethod.ReadWrite Read and write user authentication methods UserAuthenticationMethod.ReadWrite.All Read and write all users' authentication methods Application Permissions \u00b6 AND You'll need to add the following Application permissions : API / Permissions name Description Channel.Create Create channels Channel.ReadBasic.All Read the names and descriptions of channels ChannelMember.Read.All Read the members of channels ChannelMember.ReadWrite.All Add and remove members from channels Device.ReadWrite.All Read and write devices DeviceManagementApps.ReadWrite.All Read and write Microsoft Intune apps DeviceManagementConfiguration.ReadWrite.All Read and write Microsoft Intune Device Configuration and Policies DeviceManagementManagedDevices.PrivilegedOperations.All Perform user-impacting remote actions on Microsoft Intune devices DeviceManagementManagedDevices.Read.All Read Microsoft Intune devices DeviceManagementManagedDevices.ReadWrite.All Read and write Microsoft Intune devices DeviceManagementRBAC.Read.All Read Microsoft Intune RBAC settings DeviceManagementRBAC.ReadWrite.All Read and write Microsoft Intune RBAC settings DeviceManagementServiceConfig.Read.All Read Microsoft Intune configuration DeviceManagementServiceConfig.ReadWrite.All Read and write Microsoft Intune configuration Directory.Read.All Read directory data Group.Create Create groups Group.Read.All Read all groups Group.ReadWrite.All Read and write all groups GroupMember.ReadWrite.All Read and write group memberships Mail.Send Send mail as a user Organization.ReadWrite.All Read and write organization information Policy.Read.All Read your organization's policies Policy.ReadWrite.AuthenticationFlows Read and write authentication flow policies Policy.ReadWrite.AuthenticationMethod Read and write authentication method policies Policy.ReadWrite.ConsentRequest Read and write consent request policy Policy.ReadWrite.ConditionalAccess Read and write conditional access policy PrivilegedAccess.ReadWrite.AzureADGroup Read and write privileged access to Azure AD groups Reports.Read.All Read all usage reports RoleManagement.ReadWrite.Directory Read and write directory RBAC settings SecurityEvents.Read.All Read your organization\u2019s security events Sites.FullControl.All Have full control of all site collections Team.ReadBasic.All Read the names and descriptions of teams TeamMember.ReadWrite.All Add and remove members from teams TeamMember.ReadWriteNonOwnerRole.All Add and remove members with non-owner role for all teams User.ReadWrite.All Read and write all users' full profiles UserAuthenticationMethod.ReadWrite.All Read and write all users' authentication methods Getting started with CIPP \u00b6 You'll need the following to get started; Your Secure Application Model information A fork of the CIPP GitHub repository. A fork of the CIPP API GitHub repository. An active Azure Subscription. A GitHub Personal Access Token. You can find instructions on what you need and the minimum permissions to do this in Microsoft's Azure Static Web Apps documentation . You only need to follow the \"Create a GitHub Personal Access Token\" section. Automated Installation \u00b6 After you have completed the prerequisites in the Getting Started section above, click the button below to run the automated setup. This does most of the work for you. If you don't want to use the automated installer, use the manual installation instructions below, but be warned that this is really not advised, there's a lot of moving parts where one could make a mistake. You will need to use the manual installation instructions if you wish to host your repo in Azure DevOps or on a GitLab instance. I can't deploy in my region \u00b6 This is because the Azure Static Web Apps (SWA) component is global by default (it picks the datacenter closest to you) however some regions don't allow deployment. Regions that allow SWA at the moment are Central US, East US 2, East Asia, West Europe and West US 2. To work around this use the alternative installation button below. This will deploy the Static Web App in Central US region however the SWA will still be served from your nearest datacenter and other parts of CIPP will be located in the region you chose so you won't notice any latency. Adding users to CIPP \u00b6 After deployment, go to your resource group in Azure and click on your Static Web App ( cipp-swa-xxxx if using automatic deployment). Click on Role Management and invite the users you want. Currently we support three roles, reader , editor , and admin . More info about the roles can be found on the Roles page. You should now be able to browse to the custom domain or the default domain, and use the CIPP control panel. It's not working, I'm having issues \u00b6 For the first 30 minutes or more the application will respond pretty slowly, this is because, among other things, the Function App (CIPP-API) has to download PowerShell modules from Microsoft. We can't make this run any faster at this time. If you have waited for at least 30 minutes and things are still not working restart the Azure Function App (Azure Portal > CIPP Resource Group > Function App > Overview > Restart), this solves 99,9% of all issues. Turn it off, turn it on again. ;) If you are still stuck, check out the FAQ page and if needed - create an issue on GitHub or seek help on the CIPP Discord Updating CIPP \u00b6 To update CIPP to a new version see the updating section of this documentation. Adding a custom domain name \u00b6 At the moment of deployment, the application will use a randomly generated name. To change this, go to your Resource Group in Azure, click on your Static Web App ( cipp-swa-xxxx if using automatic deployment) and click on Custom Domains. You'll be able to add your own domain name here. Microsoft Docs - Set up a custom domain with free certificate in Azure Static Web Apps Manual Instructions - Here be Dragons \u00b6 If you don't want to, or can't, install CIPP automatically you can use the following steps to create the required Azure services manually. Create an Azure Function host \u00b6 Create an Azure Function App and upload the data from the CIPP-API to the Azure Function, or attach it to your fork. Each time we update the central repository you must also update your fork to keep current. After creating the Azure function, Enable system managed identity for the Azure Function. Microsoft Docs - How to use managed identities for App Service and Azure Functions Give the managed identity \"Reader\" access on the Azure Subscription. Microsoft Docs - Assign Azure Roles to a managed identity Create an Azure Key Vault \u00b6 Create an Azure Key Vault and give the system managed identity access to update, read, and create Secrets. This keyvault will be used to store credentials and tokens for the application. Microsoft Docs - Assign a Key Vault access policy Create an Azure Static Web App \u00b6 Create a premium Azure Static Web App in the Azure portal and use the CIPP repository fork you've made as the source. Each time an update is executed you must pull the latest changes into your fork and push (deploy) these to the Static Web App. This deployment can be automated with GitHub Actions, Azure DevOps Pipelines or GitLab CI/CD (and/or other CI/CD tools). After creation, perform the following changes: Attach the Function App to the Static Web App. Microsoft Docs - Bring your own functions to Azure Static Web Apps","title":"Installation"},{"location":"GettingStarted/Installation/#prerequisites","text":"For the installation and maintenance, we assume you have some knowledge of GitHub (or Git in general), and have setup the Secure Application Model prior to install. Haven't setup the Secure Application model yet? Check out this CyberDrain blog post . For a step-by-step guide to setting up the Secure Application Model, see this Gavsto blog post . Just the code. If you're just looking for the SAM script - you can find it below: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 Param ( [ Parameter ( Mandatory = $false )] [switch] $ConfigurePreconsent , [ Parameter ( Mandatory = $true )] [string] $DisplayName , [ Parameter ( Mandatory = $false )] [string] $TenantId ) $ErrorActionPreference = \"Stop\" # Check if the Azure AD PowerShell module has already been loaded. if ( ! ( Get-Module AzureAD ) ) { # Check if the Azure AD PowerShell module is installed. if ( Get-Module -ListAvailable -Name AzureAD ) { # The Azure AD PowerShell module is not load and it is installed. This module # must be loaded for other operations performed by this script. Write-Host -ForegroundColor Green \"Loading the Azure AD PowerShell module...\" Import-Module AzureAD } else { Install-Module AzureAD } } try { Write-Host -ForegroundColor Green \"When prompted please enter the appropriate credentials... Warning: Window might have pop-under in VSCode\" if ( [string] :: IsNullOrEmpty ( $TenantId )) { Connect-AzureAD | Out-Null $TenantId = $( Get-AzureADTenantDetail ). ObjectId } else { Connect-AzureAD -TenantId $TenantId | Out-Null } } catch [Microsoft.Azure.Common.Authentication.AadAuthenticationCanceledException] { # The authentication attempt was canceled by the end-user. Execution of the script should be halted. Write-Host -ForegroundColor Yellow \"The authentication attempt was canceled. Execution of the script will be halted...\" Exit } catch { # An unexpected error has occurred. The end-user should be notified so that the appropriate action can be taken. Write-Error \"An unexpected error has occurred. Please review the following error message and try again.\" ` \" $( $Error [ 0 ]. Exception ) \" } $adAppAccess = [Microsoft.Open.AzureAD.Model.RequiredResourceAccess] @{ ResourceAppId = \"00000002-0000-0000-c000-000000000000\" ; ResourceAccess = [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"5778995a-e1bf-45b8-affa-663a9f3f4d04\" ; Type = \"Role\" }, [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"a42657d6-7f20-40e3-b6f0-cee03008a62a\" ; Type = \"Scope\" }, [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"311a71cc-e848-46a1-bdf8-97ff7156d8e6\" ; Type = \"Scope\" } } $graphAppAccess = [Microsoft.Open.AzureAD.Model.RequiredResourceAccess] @{ ResourceAppId = \"00000003-0000-0000-c000-000000000000\" ; ResourceAccess = [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"bf394140-e372-4bf9-a898-299cfc7564e5\" ; Type = \"Role\" }, [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"7ab1d382-f21e-4acd-a863-ba3e13f7da61\" ; Type = \"Role\" } } $partnerCenterAppAccess = [Microsoft.Open.AzureAD.Model.RequiredResourceAccess] @{ ResourceAppId = \"fa3d9a0c-3fb0-42cc-9193-47c7ecd2edbd\" ; ResourceAccess = [Microsoft.Open.AzureAD.Model.ResourceAccess] @{ Id = \"1cebfa2a-fb4d-419e-b5f9-839b4383e05a\" ; Type = \"Scope\" } } $SessionInfo = Get-AzureADCurrentSessionInfo Write-Host -ForegroundColor Green \"Creating the Azure AD application and related resources...\" $app = New-AzureADApplication -AvailableToOtherTenants $true -DisplayName $DisplayName -IdentifierUris \"https:// $( $SessionInfo . TenantDomain ) / $(( New-Guid ). ToString ()) \" -RequiredResourceAccess $adAppAccess , $graphAppAccess , $partnerCenterAppAccess -ReplyUrls @( \"urn:ietf:wg:oauth:2.0:oob\" , \"https://login.microsoftonline.com/organizations/oauth2/nativeclient\" , \"https://localhost\" , \"http://localhost\" , \"http://localhost:8400\" ) $password = New-AzureADApplicationPasswordCredential -ObjectId $app . ObjectId $spn = New-AzureADServicePrincipal -AppId $app . AppId -DisplayName $DisplayName $adminAgentsGroup = Get-AzureADGroup -Filter \"DisplayName eq 'AdminAgents'\" Add-AzureADGroupMember -ObjectId $adminAgentsGroup . ObjectId -RefObjectId $spn . ObjectId write-host \"Installing PartnerCenter Module.\" -ForegroundColor Green install-module PartnerCenter -Force write-host \"Sleeping for 30 seconds to allow app creation on O365\" -foregroundcolor green start-sleep 30 write-host \"Please approve General consent form.\" -ForegroundColor Green $PasswordToSecureString = $password . value | ConvertTo-SecureString -asPlainText -Force $credential = New-Object System . Management . Automation . PSCredential ($( $app . AppId ), $PasswordToSecureString ) $token = New-PartnerAccessToken -ApplicationId \" $( $app . AppId ) \" -Scopes 'https://api.partnercenter.microsoft.com/user_impersonation' -ServicePrincipal -Credential $credential -Tenant $( $spn . AppOwnerTenantID ) -UseAuthorizationCode write-host \"Please approve Exchange consent form.\" -ForegroundColor Green $Exchangetoken = New-PartnerAccessToken -ApplicationId 'a0c73c16-a7e3-4564-9a95-2bdf47383716' -Scopes 'https://outlook.office365.com/.default' -Tenant $( $spn . AppOwnerTenantID ) -UseDeviceAuthentication write-host \"Last initation required: Please browse to https://login.microsoftonline.com/ $( $spn . AppOwnerTenantID ) /adminConsent?client_id= $( $app . AppId ) \" write-host \"Press any key after auth. An error report about incorrect URIs is expected!\" [void][System.Console] :: ReadKey ( $true ) Write-Host \"================ Secrets ================\" Write-Host \" `$ ApplicationId = $( $app . AppId ) \" Write-Host \" `$ ApplicationSecret = $( $password . Value ) \" Write-Host \" `$ TenantID = $( $spn . AppOwnerTenantID ) \" write-host \" `$ RefreshToken = $( $token . refreshtoken ) \" -ForegroundColor Blue write-host \" `$ Exchange RefreshToken = $( $ExchangeToken . Refreshtoken ) \" -ForegroundColor Green Write-Host \"================ Secrets ================\" Write-Host \" SAVE THESE IN A SECURE LOCATION \" You'll also need the following permissions for your secure application model, to add permissions follow these instructions: Go to the Azure Portal . Click on Azure Active Directory , now click on App Registrations . Find your Secure App Model application. You can search based on the Application ID. Go to API Permissions and click Add a permission . Choose \u201cMicrosoft Graph\u201d and \u201cDelegated permission\u201d or \"Application Permissions\" Add the permission you need Finally, click on \u201cGrant Admin Consent\u201d for Company Name.","title":"Prerequisites"},{"location":"GettingStarted/Installation/#permissions","text":"For full functionality, you'll need the following permissions for your Secure Application Model. You can remove any permissions if you do not want the application to be able to use that functionality. Duplicate Permissions Some permissions may appear to be duplicated in the Delegated and Application permissions tables below. This is by design and you do need to add both permissions!","title":"Permissions"},{"location":"GettingStarted/Installation/#delegated-permissions","text":"You'll need to add the following Delegated permissions : API / Permissions name Description Application.Read.All Read applications Application.ReadWrite.All Read and write all applications AuditLog.Read.All Read audit log data Channel.Create Create channels Channel.ReadBasic.All Read the names and descriptions of channels ChannelMember.Read.All Read the members of channels ChannelMember.ReadWrite.All Add and remove members from channels ChannelMessage.Delete Delete users' channel messages ChannelMessage.Edit Edit users' channel messages ChannelMessage.Read.All Read users' channel messages ChannelMessage.Send Send channel messages ChannelSettings.Read.All Read the names, descriptions, and settings of channels ChannelSettings.ReadWrite.All Read and write the names, descriptions, and settings of channels ConsentRequest.Read.All Read consent requests Device.Command Communicate with user devices Device.Read Read user devices Device.Read.All Read all devices DeviceManagementApps.ReadWrite.All Read and write Microsoft Intune apps DeviceManagementConfiguration.ReadWrite.All Read and write Microsoft Intune Device Configuration and Policies DeviceManagementManagedDevices.ReadWrite.All Read and write Microsoft Intune devices DeviceManagementRBAC.ReadWrite.All Read and write Microsoft Intune RBAC settings DeviceManagementServiceConfig.ReadWrite.All Read and write Microsoft Intune configuration Directory.AccessAsUser.All Access directory as the signed in user Domain.Read.All Read domain data Group.ReadWrite.All Read and write all groups GroupMember.ReadWrite.All Read and write group memberships Mail.Send Send mail as a user Mail.Send.Shared Send mail on behalf of others Member.Read.Hidden Read hidden memberships Organization.ReadWrite.All Read and write organization information Policy.Read.All Read your organization's policies Policy.ReadWrite.AuthenticationFlows Read and write authentication flow policies Policy.ReadWrite.AuthenticationMethod Read and write authentication method policies Policy.ReadWrite.Authorization Read and write your organization's authorization policy Policy.ReadWrite.ConsentRequest Read and write consent request policy Policy.ReadWrite.ConditionalAccess Read and write conditional access policy Policy.ReadWrite.DeviceConfiguration Read and write your organization's device configuration policies PrivilegedAccess.Read.AzureResources Read privileged access to Azure resources PrivilegedAccess.ReadWrite.AzureResources Read and write privileged access to Azure resources OpenID permissions - profile View users' basic profile Reports.Read.All Read all usage reports RoleManagement.ReadWrite.Directory Read and write directory RBAC settings SecurityActions.ReadWrite.All Read and update your organization's security actions SecurityEvents.ReadWrite.All Read and update your organization\u2019s security events ServiceHealth.Read.All Read service health ServiceMessage.Read.All Read service announcement messages Sites.ReadWrite.All Edit or delete items in all site collections TeamMember.ReadWrite.All Add and remove members from teams TeamMember.ReadWriteNonOwnerRole.All Add and remove members with non-owner role for all teams TeamsActivity.Read Read users' teamwork activity feed TeamsActivity.Send Send a teamwork activity as the user TeamsApp.Read Read users' installed Teams apps TeamsApp.Read.All Read all installed Teams apps TeamsApp.ReadWrite Manage users' Teams apps TeamsApp.ReadWrite.All Manage all Teams apps TeamsAppInstallation.ReadForChat Read installed Teams apps in chats TeamsAppInstallation.ReadForTeam Read installed Teams apps in teams TeamsAppInstallation.ReadForUser Read users' installed Teams apps TeamsAppInstallation.ReadWriteForChat Manage installed Teams apps in chats TeamsAppInstallation.ReadWriteForTeam Manage installed Teams apps in teams TeamsAppInstallation.ReadWriteForUser Manage users' installed Teams apps TeamsAppInstallation.ReadWriteSelfForChat Allow the Teams app to manage itself in chats TeamsAppInstallation.ReadWriteSelfForTeam Allow the app to manage itself in teams TeamsAppInstallation.ReadWriteSelfForUser Allow the Teams app to manage itself for a user TeamSettings.Read.All Read teams' settings TeamSettings.ReadWrite.All Read and change teams' settings TeamsTab.Create Create tabs in Microsoft Teams TeamsTab.Read.All Read tabs in Microsoft Teams TeamsTab.ReadWrite.All Read and write tabs in Microsoft Teams TeamsTab.ReadWriteForChat Allow the Teams app to manage all tabs in chats TeamsTab.ReadWriteForTeam Allow the Teams app to manage all tabs in teams TeamsTab.ReadWriteForUser Allow the Teams app to manage all tabs for a user Team.Create Create teams Team.ReadBasic.All Read the names and descriptions of teams ThreatAssessment.ReadWrite.All Read and write threat assessment requests UnifiedGroupMember.Read.AsGuest Read unified group memberships as guest User.ManageIdentities.All Manage user identities User.Read Sign in and read user profile User.ReadWrite.All Read and write all users' full profiles UserAuthenticationMethod.Read.All Read all users' authentication methods UserAuthenticationMethod.ReadWrite Read and write user authentication methods UserAuthenticationMethod.ReadWrite.All Read and write all users' authentication methods","title":"Delegated Permissions"},{"location":"GettingStarted/Installation/#application-permissions","text":"AND You'll need to add the following Application permissions : API / Permissions name Description Channel.Create Create channels Channel.ReadBasic.All Read the names and descriptions of channels ChannelMember.Read.All Read the members of channels ChannelMember.ReadWrite.All Add and remove members from channels Device.ReadWrite.All Read and write devices DeviceManagementApps.ReadWrite.All Read and write Microsoft Intune apps DeviceManagementConfiguration.ReadWrite.All Read and write Microsoft Intune Device Configuration and Policies DeviceManagementManagedDevices.PrivilegedOperations.All Perform user-impacting remote actions on Microsoft Intune devices DeviceManagementManagedDevices.Read.All Read Microsoft Intune devices DeviceManagementManagedDevices.ReadWrite.All Read and write Microsoft Intune devices DeviceManagementRBAC.Read.All Read Microsoft Intune RBAC settings DeviceManagementRBAC.ReadWrite.All Read and write Microsoft Intune RBAC settings DeviceManagementServiceConfig.Read.All Read Microsoft Intune configuration DeviceManagementServiceConfig.ReadWrite.All Read and write Microsoft Intune configuration Directory.Read.All Read directory data Group.Create Create groups Group.Read.All Read all groups Group.ReadWrite.All Read and write all groups GroupMember.ReadWrite.All Read and write group memberships Mail.Send Send mail as a user Organization.ReadWrite.All Read and write organization information Policy.Read.All Read your organization's policies Policy.ReadWrite.AuthenticationFlows Read and write authentication flow policies Policy.ReadWrite.AuthenticationMethod Read and write authentication method policies Policy.ReadWrite.ConsentRequest Read and write consent request policy Policy.ReadWrite.ConditionalAccess Read and write conditional access policy PrivilegedAccess.ReadWrite.AzureADGroup Read and write privileged access to Azure AD groups Reports.Read.All Read all usage reports RoleManagement.ReadWrite.Directory Read and write directory RBAC settings SecurityEvents.Read.All Read your organization\u2019s security events Sites.FullControl.All Have full control of all site collections Team.ReadBasic.All Read the names and descriptions of teams TeamMember.ReadWrite.All Add and remove members from teams TeamMember.ReadWriteNonOwnerRole.All Add and remove members with non-owner role for all teams User.ReadWrite.All Read and write all users' full profiles UserAuthenticationMethod.ReadWrite.All Read and write all users' authentication methods","title":"Application Permissions"},{"location":"GettingStarted/Installation/#getting-started-with-cipp","text":"You'll need the following to get started; Your Secure Application Model information A fork of the CIPP GitHub repository. A fork of the CIPP API GitHub repository. An active Azure Subscription. A GitHub Personal Access Token. You can find instructions on what you need and the minimum permissions to do this in Microsoft's Azure Static Web Apps documentation . You only need to follow the \"Create a GitHub Personal Access Token\" section.","title":"Getting started with CIPP"},{"location":"GettingStarted/Installation/#automated-installation","text":"After you have completed the prerequisites in the Getting Started section above, click the button below to run the automated setup. This does most of the work for you. If you don't want to use the automated installer, use the manual installation instructions below, but be warned that this is really not advised, there's a lot of moving parts where one could make a mistake. You will need to use the manual installation instructions if you wish to host your repo in Azure DevOps or on a GitLab instance.","title":"Automated Installation"},{"location":"GettingStarted/Installation/#i-cant-deploy-in-my-region","text":"This is because the Azure Static Web Apps (SWA) component is global by default (it picks the datacenter closest to you) however some regions don't allow deployment. Regions that allow SWA at the moment are Central US, East US 2, East Asia, West Europe and West US 2. To work around this use the alternative installation button below. This will deploy the Static Web App in Central US region however the SWA will still be served from your nearest datacenter and other parts of CIPP will be located in the region you chose so you won't notice any latency.","title":"I can't deploy in my region"},{"location":"GettingStarted/Installation/#adding-users-to-cipp","text":"After deployment, go to your resource group in Azure and click on your Static Web App ( cipp-swa-xxxx if using automatic deployment). Click on Role Management and invite the users you want. Currently we support three roles, reader , editor , and admin . More info about the roles can be found on the Roles page. You should now be able to browse to the custom domain or the default domain, and use the CIPP control panel.","title":"Adding users to CIPP"},{"location":"GettingStarted/Installation/#its-not-working-im-having-issues","text":"For the first 30 minutes or more the application will respond pretty slowly, this is because, among other things, the Function App (CIPP-API) has to download PowerShell modules from Microsoft. We can't make this run any faster at this time. If you have waited for at least 30 minutes and things are still not working restart the Azure Function App (Azure Portal > CIPP Resource Group > Function App > Overview > Restart), this solves 99,9% of all issues. Turn it off, turn it on again. ;) If you are still stuck, check out the FAQ page and if needed - create an issue on GitHub or seek help on the CIPP Discord","title":"It's not working, I'm having issues"},{"location":"GettingStarted/Installation/#updating-cipp","text":"To update CIPP to a new version see the updating section of this documentation.","title":"Updating CIPP"},{"location":"GettingStarted/Installation/#adding-a-custom-domain-name","text":"At the moment of deployment, the application will use a randomly generated name. To change this, go to your Resource Group in Azure, click on your Static Web App ( cipp-swa-xxxx if using automatic deployment) and click on Custom Domains. You'll be able to add your own domain name here. Microsoft Docs - Set up a custom domain with free certificate in Azure Static Web Apps","title":"Adding a custom domain name"},{"location":"GettingStarted/Installation/#manual-instructions-here-be-dragons","text":"If you don't want to, or can't, install CIPP automatically you can use the following steps to create the required Azure services manually.","title":"Manual Instructions - Here be Dragons"},{"location":"GettingStarted/Installation/#create-an-azure-function-host","text":"Create an Azure Function App and upload the data from the CIPP-API to the Azure Function, or attach it to your fork. Each time we update the central repository you must also update your fork to keep current. After creating the Azure function, Enable system managed identity for the Azure Function. Microsoft Docs - How to use managed identities for App Service and Azure Functions Give the managed identity \"Reader\" access on the Azure Subscription. Microsoft Docs - Assign Azure Roles to a managed identity","title":"Create an Azure Function host"},{"location":"GettingStarted/Installation/#create-an-azure-key-vault","text":"Create an Azure Key Vault and give the system managed identity access to update, read, and create Secrets. This keyvault will be used to store credentials and tokens for the application. Microsoft Docs - Assign a Key Vault access policy","title":"Create an Azure Key Vault"},{"location":"GettingStarted/Installation/#create-an-azure-static-web-app","text":"Create a premium Azure Static Web App in the Azure portal and use the CIPP repository fork you've made as the source. Each time an update is executed you must pull the latest changes into your fork and push (deploy) these to the Static Web App. This deployment can be automated with GitHub Actions, Azure DevOps Pipelines or GitLab CI/CD (and/or other CI/CD tools). After creation, perform the following changes: Attach the Function App to the Static Web App. Microsoft Docs - Bring your own functions to Azure Static Web Apps","title":"Create an Azure Static Web App"},{"location":"GettingStarted/Roles/","text":"Role management \u00b6 With version 1.3: Gin. We've introduced a new role management system. These roles are as follows; readonly - a user that is only allowed to read and list items, and send push messages to users. editor - a user that is allowed to perform everything, except editing tenant exclusions and standards. admin - a user that is allowed to perform everything. Adding these roles is done using the invite system of the Static Web App. You can find this at the following location: Go to the Azure Portal Go to your CIPP Resource Group Click on CIPP-SWA-XXXX Click on Role Management (Not IAM. Role Management.) Click invite user Add the roles for the user. Current known issues / Limitations \u00b6 None. This should work as expected. If you have any issues. Please report this as a bug.","title":"Roles"},{"location":"GettingStarted/Roles/#role-management","text":"With version 1.3: Gin. We've introduced a new role management system. These roles are as follows; readonly - a user that is only allowed to read and list items, and send push messages to users. editor - a user that is allowed to perform everything, except editing tenant exclusions and standards. admin - a user that is allowed to perform everything. Adding these roles is done using the invite system of the Static Web App. You can find this at the following location: Go to the Azure Portal Go to your CIPP Resource Group Click on CIPP-SWA-XXXX Click on Role Management (Not IAM. Role Management.) Click invite user Add the roles for the user.","title":"Role management"},{"location":"GettingStarted/Roles/#current-known-issues-limitations","text":"None. This should work as expected. If you have any issues. Please report this as a bug.","title":"Current known issues / Limitations"},{"location":"GettingStarted/Security/","text":"Security Policy \u00b6 Supported Versions \u00b6 Any build that is upped to a release is a supported version and should not have any security bugs. Feel free to report for any of the current releases. If you find an issue in an older release that is already removed feel free to also report this in case of regression, I'd rather know we made a mistake at one point in time and avoid that for the future. Reporting a Vulnerability \u00b6 Reporting a vunerability is best done via the instructions in the Security Policy . This way all contributors are alerted and we can discuss the issue in private. it'll help in making the fix available as soon as possible without endangering other users of the product. We will pubicly release any security report after resolution, including all communications, if you'd rather have just the bug report public, please let us know in the report. Notifications and security advisories \u00b6 We report any security notification via the Github notication and advisory system. Sponsors that are hosted will also receive a notification in case a major bug has been found. Bounties and Rewards \u00b6 This project is an open source sponsorware effort, which makes it hard to create a monetary reward without breaking the bank very quickly. for critical level bugs, that cause RCE/API data leaks/etc I will award a 50 dollar reward. For other bugs, I potentially am able to reward with some swag such as an official CyberDrain T-shirt or hoodie :)","title":"Security"},{"location":"GettingStarted/Security/#security-policy","text":"","title":"Security Policy"},{"location":"GettingStarted/Security/#supported-versions","text":"Any build that is upped to a release is a supported version and should not have any security bugs. Feel free to report for any of the current releases. If you find an issue in an older release that is already removed feel free to also report this in case of regression, I'd rather know we made a mistake at one point in time and avoid that for the future.","title":"Supported Versions"},{"location":"GettingStarted/Security/#reporting-a-vulnerability","text":"Reporting a vunerability is best done via the instructions in the Security Policy . This way all contributors are alerted and we can discuss the issue in private. it'll help in making the fix available as soon as possible without endangering other users of the product. We will pubicly release any security report after resolution, including all communications, if you'd rather have just the bug report public, please let us know in the report.","title":"Reporting a Vulnerability"},{"location":"GettingStarted/Security/#notifications-and-security-advisories","text":"We report any security notification via the Github notication and advisory system. Sponsors that are hosted will also receive a notification in case a major bug has been found.","title":"Notifications and security advisories"},{"location":"GettingStarted/Security/#bounties-and-rewards","text":"This project is an open source sponsorware effort, which makes it hard to create a monetary reward without breaking the bank very quickly. for critical level bugs, that cause RCE/API data leaks/etc I will award a 50 dollar reward. For other bugs, I potentially am able to reward with some swag such as an official CyberDrain T-shirt or hoodie :)","title":"Bounties and Rewards"},{"location":"GettingStarted/Updating/","text":"Updating \u00b6 Updating your application to the latest release can be done by the following instructions: Go to your CIPP fork on Github Click on Fetch Upstream Click on Fetch and Merge You'll now download the latest version of the frontend. To update the backend you follow these instructions; Go to your CIPP-API fork on Github Click on Fetch Upstream Click on Fetch and Merge Go to the Azure Portal Go to your CIPP resource group Click on the Azure Function Click on \"Deployment Center\" Click on Sync. You've now updated the application.","title":"Updating"},{"location":"GettingStarted/Updating/#updating","text":"Updating your application to the latest release can be done by the following instructions: Go to your CIPP fork on Github Click on Fetch Upstream Click on Fetch and Merge You'll now download the latest version of the frontend. To update the backend you follow these instructions; Go to your CIPP-API fork on Github Click on Fetch Upstream Click on Fetch and Merge Go to the Azure Portal Go to your CIPP resource group Click on the Azure Function Click on \"Deployment Center\" Click on Sync. You've now updated the application.","title":"Updating"},{"location":"IdentityManagement/Groups/","text":"Groups \u00b6 Using the groups pages you can easily edit groups and add users to groups, you can also create new groups. Current known issues / Limitations \u00b6 Groups currently do not return all data such as external senders, and not all settings can be set by partners. Microsoft is aware and will fix this in a new release of the Graph API.","title":"Groups"},{"location":"IdentityManagement/Groups/#groups","text":"Using the groups pages you can easily edit groups and add users to groups, you can also create new groups.","title":"Groups"},{"location":"IdentityManagement/Groups/#current-known-issues-limitations","text":"Groups currently do not return all data such as external senders, and not all settings can be set by partners. Microsoft is aware and will fix this in a new release of the Graph API.","title":"Current known issues / Limitations"},{"location":"IdentityManagement/Users/","text":"Using the users pages you can easily edit users and add users to groups or change their licenses, you can also create new users. There's also several quick buttons; Convert user to shared mailbox Disable user Reset user password We have not made any confirmation pop-ups, so clicking makes the activity start. Current known issues / Limitations \u00b6 Groups currently do not return all data such as external senders, and not all settings can be set by partners. Microsoft is aware and will fix this in a new release of the Graph API.","title":"Users"},{"location":"IdentityManagement/Users/#current-known-issues-limitations","text":"Groups currently do not return all data such as external senders, and not all settings can be set by partners. Microsoft is aware and will fix this in a new release of the Graph API.","title":"Current known issues / Limitations"},{"location":"OneDriveTeamsSharepoint/OneDrive/","text":"OneDrive / Sharepoint / Teams \u00b6 This page can be used to report on OneDrive and SharePoint usage. This usage allows you to check how well iplementation is going and if all users are actively using their OneDrive and Sharepoint sites. You can also see if users have received maximum file usage or not. Current known issues / Limitations \u00b6 The data returned by this API might be pseudo-anonimzed. Run the standard \"Enable Usernames instead of pseudo anonymised names names in reports\" to prevent this.","title":"OneDrive"},{"location":"OneDriveTeamsSharepoint/OneDrive/#onedrive-sharepoint-teams","text":"This page can be used to report on OneDrive and SharePoint usage. This usage allows you to check how well iplementation is going and if all users are actively using their OneDrive and Sharepoint sites. You can also see if users have received maximum file usage or not.","title":"OneDrive / Sharepoint / Teams"},{"location":"OneDriveTeamsSharepoint/OneDrive/#current-known-issues-limitations","text":"The data returned by this API might be pseudo-anonimzed. Run the standard \"Enable Usernames instead of pseudo anonymised names names in reports\" to prevent this.","title":"Current known issues / Limitations"},{"location":"TenantAdministration/BestPracticesAnalyser/","text":"Best Practice Analyser \u00b6 The Best Practice Analyser is a series of checks that run against all of your 365 tenants. The Best Practice concept of this has been wideless discussed with numerous MSPs. Most of these Best Practices have been derived from the standards portion of CIPP. The Best Practice Analyser is entirely read only. It will not make any changes to your tenants. Current known issues / Limitations \u00b6 The final plan will be to have the data refresh once a day. With version 1.2.0 you will need to refresh the data manually. How do I get started? \u00b6 In the left hand menu, navigate to Tenant Administration > Standards > Best Practice Analyser . If this is your first ever run you may see an error initially because there is no data; this is expected. How do I refresh or generate the data? \u00b6 At the top of the page there is button called Force Refresh All Data . You only need to click this once. Interpreting Results \u00b6 The reporting here generally follows a standard colour theming. Red is bad and generally not something that should be happening on your tenant. Orange is either a warning or subjective. It does not necessarily indicate something is wrong. Green means there are no issues or the setting is set in a manner that is generally agreed as Best Practice. Unified Audit Log Enabled \u00b6 This Best Practice checks that on your tenants that the Unified Audit Log is enabled. This is 365's major log and contains user, group, application, domain and directory activities. This absolutely should be enabled. Security Defaults Enabled \u00b6 This Best Practice is a check to see if Security Defaults are enabled. Security Defaults are preconfigured security settings that apply against your tenant that ensure things like MFA is enabled, legacy authentication protocols are blocked etc. The enabling of this is subjective, which is why it being turned off denotes an orange warning. Message Copy for Sent As \u00b6 This is a clickable button which will show you individual accounts where this is not enabled. This refers to the Automatic saving of sent items in delegators mailbox. Mailboxes in Microsoft 365 or Office 365 can be set up so that someone (such as an executive assistant) can access the mailbox of another person (such as a manager) and send mail as them. These people are often called the delegate and the delegator, respectively. We'll call them \"assistant\" and \"manager\" for simplicity's sake. When an assistant is granted access to a manager's mailbox, it's called delegated access. People often set up delegated access and send permissions to allow an assistant to manage a manager's calendar where they need to send and respond to meeting requests. By default, when an assistant sends mail as, or on behalf of, a manager, the sent message is stored in the assistant's Sent Items folder and not in the Managers. It is possible to set it so that the Manager gets it put in to their sent items too. This Best Practice is checking that these settings are enabled for people who has Send As and Send on Behalf. The enabling of this is subjective, which is why when it's off it denotes an orange warning. User Cannot Consent to Apps \u00b6 This Best Practice checks whether users can give consent to apps that use OpenID Connect and OAuth 2.0 for sign-in and requests to access data. An app can be created from within your own organization, or it can come from another Office 365 organization or a third-party. It is a well known best practice that users SHOULD NOT be able to give consent to apps. If this setting is on, this denotes a red warning. This is a security risk you should mitigate. Passwords do not Expire \u00b6 This setting is checking whether the tenant has set passwords to expire or not. It is general best practice now that passwords SHOULD NOT expire. If Password Expiry is on, this will generate a red alert. Privacy in Reports Enabled \u00b6 A number of the reports that pre-generate in Microsoft 365 have personally identifiable information (like a users name). This makes reporting very difficult. We believe this is better disabled to enable for more accurate reporting, which brings security benefits on its own. This however is subjective, so if Privacy in Reports is Enabled, you will receive an orange warning. Self Service Password Reset Enabled \u00b6 This is an organisational setting that when enabled allows users to reset their own passwords through a forgot your password type identification. There are three possible results here. Self Service Password Reset is Off all Users, On all User, On Specific Users. The enabling of this is subjective so when this is not enabled you will receive an orange warning. Modern Auth Enabled \u00b6 Modern authentication is a core security component of 365 and allows for authentication features like MFA, smart cards, third-party SAML providers etc. This should absolutely be enabled, and when it isn't you will be presented with a red error. Shared Mailboxes Logins Disabled \u00b6 This is a clickable button, which will show a modal popup with the accounts that are meeting this criteria. This is a check to see if you have shared mailboxes attached to a valid account that can still login. Shared mailboxes in nearly all cases should not have a login account attached to it. We see this mostly when a user leaves a business, they are converted from a paid license to a free shared mailbox, and the license is removed. This still leaves an active account linked to the shared mailbox, even if the password has been changed this increases risk unnecessarily. Where you have any of these accounts, the result is red. Unused Licenses \u00b6 This is a clickable button which will show you where you have unused licenses. This goes through all the licenses that are assigned in every tenant and compares the purchased number with the number consumed. Where there is a difference in this number this is normally because you have licenses that you are paying for, but are not being used. We are whitelisting common licenses that don't matter, for example unassigned free licenses or trials. If you have any SKUs you wish us to whitelist from this check please raise an enhancement request in Github. I am having Problems \u00b6 Please ensure that you have given adequate time for the Best Practice Analyser to run. In an environment with 100 tenants this takes on average 15 minutes. Please ensure that your permissions are correct by going in to CIPP Settings > Configuration Settings > Run Permission Check . Make sure your CIPP-API and CIPP modules are both fully up-to-date. There is extensive logging in the log file in the root of the CIPP-API Function App. I have something to add or an idea for Best Practices \u00b6 Excellent! Please add them to the Github Issues as a feature request","title":"Best Practices Analyser"},{"location":"TenantAdministration/BestPracticesAnalyser/#best-practice-analyser","text":"The Best Practice Analyser is a series of checks that run against all of your 365 tenants. The Best Practice concept of this has been wideless discussed with numerous MSPs. Most of these Best Practices have been derived from the standards portion of CIPP. The Best Practice Analyser is entirely read only. It will not make any changes to your tenants.","title":"Best Practice Analyser"},{"location":"TenantAdministration/BestPracticesAnalyser/#current-known-issues-limitations","text":"The final plan will be to have the data refresh once a day. With version 1.2.0 you will need to refresh the data manually.","title":"Current known issues / Limitations"},{"location":"TenantAdministration/BestPracticesAnalyser/#how-do-i-get-started","text":"In the left hand menu, navigate to Tenant Administration > Standards > Best Practice Analyser . If this is your first ever run you may see an error initially because there is no data; this is expected.","title":"How do I get started?"},{"location":"TenantAdministration/BestPracticesAnalyser/#how-do-i-refresh-or-generate-the-data","text":"At the top of the page there is button called Force Refresh All Data . You only need to click this once.","title":"How do I refresh or generate the data?"},{"location":"TenantAdministration/BestPracticesAnalyser/#interpreting-results","text":"The reporting here generally follows a standard colour theming. Red is bad and generally not something that should be happening on your tenant. Orange is either a warning or subjective. It does not necessarily indicate something is wrong. Green means there are no issues or the setting is set in a manner that is generally agreed as Best Practice.","title":"Interpreting Results"},{"location":"TenantAdministration/BestPracticesAnalyser/#unified-audit-log-enabled","text":"This Best Practice checks that on your tenants that the Unified Audit Log is enabled. This is 365's major log and contains user, group, application, domain and directory activities. This absolutely should be enabled.","title":"Unified Audit Log Enabled"},{"location":"TenantAdministration/BestPracticesAnalyser/#security-defaults-enabled","text":"This Best Practice is a check to see if Security Defaults are enabled. Security Defaults are preconfigured security settings that apply against your tenant that ensure things like MFA is enabled, legacy authentication protocols are blocked etc. The enabling of this is subjective, which is why it being turned off denotes an orange warning.","title":"Security Defaults Enabled"},{"location":"TenantAdministration/BestPracticesAnalyser/#message-copy-for-sent-as","text":"This is a clickable button which will show you individual accounts where this is not enabled. This refers to the Automatic saving of sent items in delegators mailbox. Mailboxes in Microsoft 365 or Office 365 can be set up so that someone (such as an executive assistant) can access the mailbox of another person (such as a manager) and send mail as them. These people are often called the delegate and the delegator, respectively. We'll call them \"assistant\" and \"manager\" for simplicity's sake. When an assistant is granted access to a manager's mailbox, it's called delegated access. People often set up delegated access and send permissions to allow an assistant to manage a manager's calendar where they need to send and respond to meeting requests. By default, when an assistant sends mail as, or on behalf of, a manager, the sent message is stored in the assistant's Sent Items folder and not in the Managers. It is possible to set it so that the Manager gets it put in to their sent items too. This Best Practice is checking that these settings are enabled for people who has Send As and Send on Behalf. The enabling of this is subjective, which is why when it's off it denotes an orange warning.","title":"Message Copy for Sent As"},{"location":"TenantAdministration/BestPracticesAnalyser/#user-cannot-consent-to-apps","text":"This Best Practice checks whether users can give consent to apps that use OpenID Connect and OAuth 2.0 for sign-in and requests to access data. An app can be created from within your own organization, or it can come from another Office 365 organization or a third-party. It is a well known best practice that users SHOULD NOT be able to give consent to apps. If this setting is on, this denotes a red warning. This is a security risk you should mitigate.","title":"User Cannot Consent to Apps"},{"location":"TenantAdministration/BestPracticesAnalyser/#passwords-do-not-expire","text":"This setting is checking whether the tenant has set passwords to expire or not. It is general best practice now that passwords SHOULD NOT expire. If Password Expiry is on, this will generate a red alert.","title":"Passwords do not Expire"},{"location":"TenantAdministration/BestPracticesAnalyser/#privacy-in-reports-enabled","text":"A number of the reports that pre-generate in Microsoft 365 have personally identifiable information (like a users name). This makes reporting very difficult. We believe this is better disabled to enable for more accurate reporting, which brings security benefits on its own. This however is subjective, so if Privacy in Reports is Enabled, you will receive an orange warning.","title":"Privacy in Reports Enabled"},{"location":"TenantAdministration/BestPracticesAnalyser/#self-service-password-reset-enabled","text":"This is an organisational setting that when enabled allows users to reset their own passwords through a forgot your password type identification. There are three possible results here. Self Service Password Reset is Off all Users, On all User, On Specific Users. The enabling of this is subjective so when this is not enabled you will receive an orange warning.","title":"Self Service Password Reset Enabled"},{"location":"TenantAdministration/BestPracticesAnalyser/#modern-auth-enabled","text":"Modern authentication is a core security component of 365 and allows for authentication features like MFA, smart cards, third-party SAML providers etc. This should absolutely be enabled, and when it isn't you will be presented with a red error.","title":"Modern Auth Enabled"},{"location":"TenantAdministration/BestPracticesAnalyser/#shared-mailboxes-logins-disabled","text":"This is a clickable button, which will show a modal popup with the accounts that are meeting this criteria. This is a check to see if you have shared mailboxes attached to a valid account that can still login. Shared mailboxes in nearly all cases should not have a login account attached to it. We see this mostly when a user leaves a business, they are converted from a paid license to a free shared mailbox, and the license is removed. This still leaves an active account linked to the shared mailbox, even if the password has been changed this increases risk unnecessarily. Where you have any of these accounts, the result is red.","title":"Shared Mailboxes Logins Disabled"},{"location":"TenantAdministration/BestPracticesAnalyser/#unused-licenses","text":"This is a clickable button which will show you where you have unused licenses. This goes through all the licenses that are assigned in every tenant and compares the purchased number with the number consumed. Where there is a difference in this number this is normally because you have licenses that you are paying for, but are not being used. We are whitelisting common licenses that don't matter, for example unassigned free licenses or trials. If you have any SKUs you wish us to whitelist from this check please raise an enhancement request in Github.","title":"Unused Licenses"},{"location":"TenantAdministration/BestPracticesAnalyser/#i-am-having-problems","text":"Please ensure that you have given adequate time for the Best Practice Analyser to run. In an environment with 100 tenants this takes on average 15 minutes. Please ensure that your permissions are correct by going in to CIPP Settings > Configuration Settings > Run Permission Check . Make sure your CIPP-API and CIPP modules are both fully up-to-date. There is extensive logging in the log file in the root of the CIPP-API Function App.","title":"I am having Problems"},{"location":"TenantAdministration/BestPracticesAnalyser/#i-have-something-to-add-or-an-idea-for-best-practices","text":"Excellent! Please add them to the Github Issues as a feature request","title":"I have something to add or an idea for Best Practices"},{"location":"TenantAdministration/DomainAnalyser/","text":"Domain Analyser \u00b6 The domain analyser is a series of best practice checks that run against all email enabled domains that can been found in your delegated 365 tenants. It analyses the DNS records that are available and assesses SPF, DMARC, DKIM and DNSSEC. Please note - clicking More at the end of each row will give you extended information about the problems identified. Current known issues / Limitations \u00b6 You may get odd results if you have different records setup for subdomains. As it stands at the moment you will only get DKIM results where the domains are utilising 365 or Google e-mail. How do I get started? \u00b6 In the left hand menu, navigate to Tenant Administration > Standards > Domain Analyser . If this is your first ever run you may see an error initially because there is no data; this is expected. How do I refresh or generate the data? \u00b6 At the top of the page there is button called Force Refresh All Data . You only need to click this once. Interpreting Results \u00b6 The reporting here generally follows a standard colour theming. Red is bad and generally not something that should be happening on your tenant. Orange is either a warning or subjective. It does not necessarily indicate something is wrong. Green means there are no issues or the setting is set in a manner that is generally agreed as Best Practice. Microsoft Secure Score \u00b6 This is Microsoft Secure Score as found in 365 tenants here: Tenant Secure Score . For further information on how to improve 365 tenant security using Secure Score actions see Microsoft's documentation here . In many cases the CIPP Standards will result in improvements in a tenant's Secure Score. SPF Pass Test \u00b6 This is looking primarily for two conditions; that you are using the recommended SPF record that Microsoft suggests. It also looks to ensure that your domains are set to hard fail as opposed to soft fail. MX Pass Test \u00b6 This is looking to ensure that your MX record is set correctly based on what Microsoft thinks it should be. Where this is failing you likely have a domain in your 365 tenant that is using e-mail elsewhere, or has a misconfigured MX record. DMARC Present \u00b6 This is the first of a number of tests that we are performing on the DMARC record. First we are making sure one exists; your domains absolutely should have a properly configured DMARC or you are putting this domain at risk of being spoofed. DMARC Action Policy \u00b6 Your DMARC record is only as good as the action set on it. If you have never added a DMARC record before, you'll want to start by creating a record in reporting only, and utilising a service like report-uri.com to assess reports. The ideal setting for this is Reject. DMARC % Pass \u00b6 It is possible to configure your DMARC to only pay attention to a certain percent of mail. This test makes sure it is assessing 100% of it. DNSSEC \u00b6 DNSSEC is the \"Domain Name System Security Extensions) and is a feature of DNS that authenticates responses to domain name lookups, preventing attackers from manipulating or poisoning the responses to DNS requests. This test is a simple enable/disable test. DKIM Enabled \u00b6 DKIM (DomainKeys Identified Mail) is an email security standard designed to make sure messages aren't altered in transit between the sending and recipient servers. It uses public-key cryptography to sign email with a private key as it leaves a sending server. This is a simple enabled/disabled test. I am having Problems \u00b6 The adding of this feature requires a new permission granting in your delegated permissions - Domain.Read.All. Please ensure that you have given adequate time for the Domain Analyser to run. In an environment with 100 tenants this takes on average 2 minutes. Please ensure that your permissions are correct by going in to CIPP Settings > Configuration Settings > Run Permission Check . Make sure your CIPP-API and CIPP modules are both fully up-to-date. There is extensive logging in the log file in the root of the CIPP-API Function App. I have something to add or an idea for Domain Analyser \u00b6 Excellent! Please add them to the Github Issues as a feature request","title":"Domain Analyser"},{"location":"TenantAdministration/DomainAnalyser/#domain-analyser","text":"The domain analyser is a series of best practice checks that run against all email enabled domains that can been found in your delegated 365 tenants. It analyses the DNS records that are available and assesses SPF, DMARC, DKIM and DNSSEC. Please note - clicking More at the end of each row will give you extended information about the problems identified.","title":"Domain Analyser"},{"location":"TenantAdministration/DomainAnalyser/#current-known-issues-limitations","text":"You may get odd results if you have different records setup for subdomains. As it stands at the moment you will only get DKIM results where the domains are utilising 365 or Google e-mail.","title":"Current known issues / Limitations"},{"location":"TenantAdministration/DomainAnalyser/#how-do-i-get-started","text":"In the left hand menu, navigate to Tenant Administration > Standards > Domain Analyser . If this is your first ever run you may see an error initially because there is no data; this is expected.","title":"How do I get started?"},{"location":"TenantAdministration/DomainAnalyser/#how-do-i-refresh-or-generate-the-data","text":"At the top of the page there is button called Force Refresh All Data . You only need to click this once.","title":"How do I refresh or generate the data?"},{"location":"TenantAdministration/DomainAnalyser/#interpreting-results","text":"The reporting here generally follows a standard colour theming. Red is bad and generally not something that should be happening on your tenant. Orange is either a warning or subjective. It does not necessarily indicate something is wrong. Green means there are no issues or the setting is set in a manner that is generally agreed as Best Practice.","title":"Interpreting Results"},{"location":"TenantAdministration/DomainAnalyser/#microsoft-secure-score","text":"This is Microsoft Secure Score as found in 365 tenants here: Tenant Secure Score . For further information on how to improve 365 tenant security using Secure Score actions see Microsoft's documentation here . In many cases the CIPP Standards will result in improvements in a tenant's Secure Score.","title":"Microsoft Secure Score"},{"location":"TenantAdministration/DomainAnalyser/#spf-pass-test","text":"This is looking primarily for two conditions; that you are using the recommended SPF record that Microsoft suggests. It also looks to ensure that your domains are set to hard fail as opposed to soft fail.","title":"SPF Pass Test"},{"location":"TenantAdministration/DomainAnalyser/#mx-pass-test","text":"This is looking to ensure that your MX record is set correctly based on what Microsoft thinks it should be. Where this is failing you likely have a domain in your 365 tenant that is using e-mail elsewhere, or has a misconfigured MX record.","title":"MX Pass Test"},{"location":"TenantAdministration/DomainAnalyser/#dmarc-present","text":"This is the first of a number of tests that we are performing on the DMARC record. First we are making sure one exists; your domains absolutely should have a properly configured DMARC or you are putting this domain at risk of being spoofed.","title":"DMARC Present"},{"location":"TenantAdministration/DomainAnalyser/#dmarc-action-policy","text":"Your DMARC record is only as good as the action set on it. If you have never added a DMARC record before, you'll want to start by creating a record in reporting only, and utilising a service like report-uri.com to assess reports. The ideal setting for this is Reject.","title":"DMARC Action Policy"},{"location":"TenantAdministration/DomainAnalyser/#dmarc-pass","text":"It is possible to configure your DMARC to only pay attention to a certain percent of mail. This test makes sure it is assessing 100% of it.","title":"DMARC % Pass"},{"location":"TenantAdministration/DomainAnalyser/#dnssec","text":"DNSSEC is the \"Domain Name System Security Extensions) and is a feature of DNS that authenticates responses to domain name lookups, preventing attackers from manipulating or poisoning the responses to DNS requests. This test is a simple enable/disable test.","title":"DNSSEC"},{"location":"TenantAdministration/DomainAnalyser/#dkim-enabled","text":"DKIM (DomainKeys Identified Mail) is an email security standard designed to make sure messages aren't altered in transit between the sending and recipient servers. It uses public-key cryptography to sign email with a private key as it leaves a sending server. This is a simple enabled/disabled test.","title":"DKIM Enabled"},{"location":"TenantAdministration/DomainAnalyser/#i-am-having-problems","text":"The adding of this feature requires a new permission granting in your delegated permissions - Domain.Read.All. Please ensure that you have given adequate time for the Domain Analyser to run. In an environment with 100 tenants this takes on average 2 minutes. Please ensure that your permissions are correct by going in to CIPP Settings > Configuration Settings > Run Permission Check . Make sure your CIPP-API and CIPP modules are both fully up-to-date. There is extensive logging in the log file in the root of the CIPP-API Function App.","title":"I am having Problems"},{"location":"TenantAdministration/DomainAnalyser/#i-have-something-to-add-or-an-idea-for-domain-analyser","text":"Excellent! Please add them to the Github Issues as a feature request","title":"I have something to add or an idea for Domain Analyser"},{"location":"TenantAdministration/Standards/","text":"The Standards page allows you to (re)set specific standards over your entire client base. The wizard allows you to select the most common settings and corrects them every 3 hours by default. If a user disables a setting it'll automatically be restored. In the next version, we will be adding more standardized options and settings, we'll also allow you to send an alert to either your RMM system or e-mail. Below are the standards explained Meet the Standards \u00b6 Standard Impact Description Enable Unified Audit Log Low Enables organisation customisation and the unified audit log for the tenant, allow you to use the logging engine Microsoft has. We have opted not to enable Mailbox logging as this is enabled default on all mailboxes now, and changing the settings is not recommended. Enable Security Defaults Medium/High Enables Microsoft's Security Defaults for Azure AD. For more info about Security Defaults, Check out Microsoft's blog here , Or CyberDrain's blog here Set mailbox Sent items Delegation Low This makes sure that e-mails sent from shared mailboxes, or people with full-access, end up in the mailbox of the shared mailbox instead of the sender, allowing you to easily keep them together. Require Admin Consent for Applications Medium This setting enables users to no longer add applications themselves, but instead have an admin approve the permissions. This prevents several oauth phishing attacks which have proven popular lately. Do not expire passwords Low Sets passwords to never expire for tenant, recommended to use in conjunction with secure passwords. Enable usernames instead of pseudo aonoymised names in reports Low Microsoft announced some of the APIs and reports will no longer contain names, to comply with legal requests by specific countries. This proves an issue for a lot of MSPs because those reports are required for engineers to monitor and react on. This changes that setting to allow to see usernames again. Enable Self service password reset Medium Enables Self Service password Reset for All Users . Communication is important as it will Requires users to register 2 authentication methods if they have not already. Enable Modern Authentication Low Enables Modern Authentication. If your tenant is newer then 2018 this should already be enabled. Disable Basic Authentication High Disables most forms of user basic authentication, allows smtp authentication as MS does not consider this a legacy protocol(yet). It's important to review Sign-ins reports to identify impact for each customer. It will cut off any connection and block future connections using legacy authentication, or which do not support modern authentication. Disable Shared Mailbox AAD account Medium Shared mailboxes allow logon to them by users if the password is reset, this a security risk as you do not know who has this password. Microsoft's recommendation is disabling the user account. Would be a good idea to review Sign-ins to establish impact. Enable auto expanding archives Medium/High Enables auto-expanding archiving for Archive Mailboxes. Note: Has impacts on inactive mailboxes and recovering deleted mailboxes and once enabled cannot be disabled after. Microsoft Documents . Enable Spoofing warnings for Outlook Low Adds external tags/indentifers to email messages In outlook. See Bleeping Computer Article Enable per-user MFA for all users Medium/High Allows you to deploy per-user MFA for all the users in the tenant. Does not allow any exclusions. If you'd like to make exclusions, please use Conditional Access instead. Impact Levels \u00b6 Low Impact - Changes which have no user-facing impact or minimal impact. Medium Impact - Changes which have a user impact that can be managed with a little communication. High Impact - Changes which should be carefully thought through and ideally managed with customers - may have significant impacts on how users interact with Microsoft 365. Current known issues / Limitations \u00b6 These jobs run asynchronously every 3 hours per default, you can check the log for the current operation by looking for \"Standards API\" The job engine might slow down other APIs temporarily if it has a lot to process.(loads of settings, loads of tenants).","title":"Standards"},{"location":"TenantAdministration/Standards/#meet-the-standards","text":"Standard Impact Description Enable Unified Audit Log Low Enables organisation customisation and the unified audit log for the tenant, allow you to use the logging engine Microsoft has. We have opted not to enable Mailbox logging as this is enabled default on all mailboxes now, and changing the settings is not recommended. Enable Security Defaults Medium/High Enables Microsoft's Security Defaults for Azure AD. For more info about Security Defaults, Check out Microsoft's blog here , Or CyberDrain's blog here Set mailbox Sent items Delegation Low This makes sure that e-mails sent from shared mailboxes, or people with full-access, end up in the mailbox of the shared mailbox instead of the sender, allowing you to easily keep them together. Require Admin Consent for Applications Medium This setting enables users to no longer add applications themselves, but instead have an admin approve the permissions. This prevents several oauth phishing attacks which have proven popular lately. Do not expire passwords Low Sets passwords to never expire for tenant, recommended to use in conjunction with secure passwords. Enable usernames instead of pseudo aonoymised names in reports Low Microsoft announced some of the APIs and reports will no longer contain names, to comply with legal requests by specific countries. This proves an issue for a lot of MSPs because those reports are required for engineers to monitor and react on. This changes that setting to allow to see usernames again. Enable Self service password reset Medium Enables Self Service password Reset for All Users . Communication is important as it will Requires users to register 2 authentication methods if they have not already. Enable Modern Authentication Low Enables Modern Authentication. If your tenant is newer then 2018 this should already be enabled. Disable Basic Authentication High Disables most forms of user basic authentication, allows smtp authentication as MS does not consider this a legacy protocol(yet). It's important to review Sign-ins reports to identify impact for each customer. It will cut off any connection and block future connections using legacy authentication, or which do not support modern authentication. Disable Shared Mailbox AAD account Medium Shared mailboxes allow logon to them by users if the password is reset, this a security risk as you do not know who has this password. Microsoft's recommendation is disabling the user account. Would be a good idea to review Sign-ins to establish impact. Enable auto expanding archives Medium/High Enables auto-expanding archiving for Archive Mailboxes. Note: Has impacts on inactive mailboxes and recovering deleted mailboxes and once enabled cannot be disabled after. Microsoft Documents . Enable Spoofing warnings for Outlook Low Adds external tags/indentifers to email messages In outlook. See Bleeping Computer Article Enable per-user MFA for all users Medium/High Allows you to deploy per-user MFA for all the users in the tenant. Does not allow any exclusions. If you'd like to make exclusions, please use Conditional Access instead.","title":"Meet the Standards"},{"location":"TenantAdministration/Standards/#impact-levels","text":"Low Impact - Changes which have no user-facing impact or minimal impact. Medium Impact - Changes which have a user impact that can be managed with a little communication. High Impact - Changes which should be carefully thought through and ideally managed with customers - may have significant impacts on how users interact with Microsoft 365.","title":"Impact Levels"},{"location":"TenantAdministration/Standards/#current-known-issues-limitations","text":"These jobs run asynchronously every 3 hours per default, you can check the log for the current operation by looking for \"Standards API\" The job engine might slow down other APIs temporarily if it has a lot to process.(loads of settings, loads of tenants).","title":"Current known issues / Limitations"},{"location":"TenantAdministration/Tenants/","text":"Tenants \u00b6 The tenants page is a shortcut and might be changed to the homepage at a later version, this page allows you to jump to the specific tenant administration centers for that client using your partner credentials. This allows you to administrate that specific tenant. The search is universal and also works on the client domains.","title":"Tenants"},{"location":"TenantAdministration/Tenants/#tenants","text":"The tenants page is a shortcut and might be changed to the homepage at a later version, this page allows you to jump to the specific tenant administration centers for that client using your partner credentials. This allows you to administrate that specific tenant. The search is universal and also works on the client domains.","title":"Tenants"}]}